import{r as n,b as g,j as e,f,a as q,u as H,i as R}from"./index-CvfVq4J2.js";import{T as D,a as U,S as F,A as W}from"./tree-palm-3tZdzzaD.js";import{P as B}from"./plus-DLgdAGDP.js";import{T as G}from"./trash-2-CxMI6zht.js";import{S as L}from"./shield-B1j7CUBB.js";function J(){const[j,l]=n.useState([]),[w,o]=n.useState(!0),[v,N]=n.useState(!1),[c,u]=n.useState(""),[d,h]=n.useState(""),[y,b]=n.useState(!1),[p,S]=n.useState(""),m=n.useCallback(async()=>{try{const t=await g("/api/vacation");l(t)}catch{}finally{o(!1)}},[]);n.useEffect(()=>{m()},[m]);const A=async()=>{if(!(!c||!d)){b(!0),S("");try{await g("/api/vacation",{method:"POST",body:{start_date:c,end_date:d}}),N(!1),u(""),h(""),m()}catch(t){S(t.message||"Failed to create vacation")}finally{b(!1)}}},C=async t=>{try{await g(`/api/vacation/${t}`,{method:"DELETE"}),m()}catch{}},x=new Date().toISOString().slice(0,10);return e.jsxs("div",{className:"game-panel p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-cream text-sm font-bold flex items-center gap-2",children:[e.jsx(D,{size:16,className:"text-emerald"}),"Vacation Mode"]}),e.jsxs("button",{onClick:()=>N(t=>!t),className:"text-xs text-sky hover:text-accent-light transition-colors font-medium flex items-center gap-1",children:[e.jsx(B,{size:12}),v?"Cancel":"Schedule"]})]}),e.jsx("p",{className:"text-muted text-xs mb-3",children:"During vacation, recurring quests are paused and streaks are preserved."}),v&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-surface-raised/50 border border-border/50 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-muted text-[10px] font-semibold uppercase",children:"Start"}),e.jsx("input",{type:"date",value:c,onChange:t=>u(t.target.value),min:x,className:"field-input text-sm mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-muted text-[10px] font-semibold uppercase",children:"End"}),e.jsx("input",{type:"date",value:d,onChange:t=>h(t.target.value),min:c||x,className:"field-input text-sm mt-1"})]})]}),p&&e.jsx("p",{className:"text-crimson text-xs",children:p}),e.jsxs("button",{onClick:A,disabled:y||!c||!d,className:"game-btn game-btn-blue w-full flex items-center justify-center gap-1.5",children:[y?e.jsx(f,{size:12,className:"animate-spin"}):e.jsx(D,{size:12}),"Schedule Vacation"]})]}),w?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(f,{size:16,className:"text-sky animate-spin"})}):j.length===0?e.jsx("p",{className:"text-muted text-xs text-center py-2",children:"No vacations scheduled."}):e.jsx("div",{className:"space-y-2",children:j.map(t=>{const _=t.end_date<x,k=t.start_date<=x&&t.end_date>=x;return e.jsxs("div",{className:`flex items-center justify-between px-3 py-2.5 rounded-lg border ${k?"border-emerald/30 bg-emerald/5":_?"border-border/30 bg-surface-raised/20 opacity-60":"border-border/50 bg-surface-raised/20"}`,children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-cream text-sm font-medium",children:[t.start_date," â†’ ",t.end_date]}),k&&e.jsx("p",{className:"text-emerald text-[10px] font-semibold uppercase mt-0.5",children:"Active now"})]}),!_&&e.jsx("button",{onClick:()=>C(t.id),className:"text-muted hover:text-crimson transition-colors p-1",title:"Cancel vacation",children:e.jsx(G,{size:14})})]},t.id)})})]})}function ee(){const j=q(),{user:l}=H(),w=(l==null?void 0:l.role)==="parent"||(l==null?void 0:l.role)==="admin",[o,v]=n.useState(null),[N,c]=n.useState(!0),[u,d]=n.useState(""),[h,y]=n.useState(!1),[b,p]=n.useState(""),[S,m]=n.useState([]),[A,C]=n.useState(!1),[x,t]=n.useState({}),_=s=>{const a={};for(const[i,r]of Object.entries(s))r==="true"?a[i]=!0:r==="false"?a[i]=!1:/^\d+$/.test(r)?a[i]=parseInt(r,10):a[i]=r;return a},k=s=>{const a={};for(const[i,r]of Object.entries(s))a[i]=String(r);return a},P=n.useCallback(async()=>{var s,a,i;c(!0),d("");try{const r=await g("/api/admin/settings");v(_(r))}catch(r){(s=r.message)!=null&&s.includes("403")||(a=r.message)!=null&&a.includes("Forbidden")||(i=r.message)!=null&&i.includes("permission")?d("Access denied. Only parents and admins can access settings."):d(r.message||"Failed to load settings")}finally{c(!1)}},[]),$=n.useCallback(async()=>{C(!0);try{const s=await g("/api/stats/achievements/all");m(s.achievements||s||[])}catch{m([])}finally{C(!1)}},[]);n.useEffect(()=>{w?(P(),$()):(c(!1),d("Access denied. Only parents and admins can access settings."))},[w,P,$]);const z=(s,a)=>{v(i=>({...i,[s]:a}))},O=async()=>{y(!0),p("");try{await g("/api/admin/settings",{method:"PUT",body:{settings:k(o)}}),p("Settings saved!"),window.dispatchEvent(new CustomEvent("settings:updated"))}catch(s){p(s.message||"Failed to save settings")}finally{y(!1),setTimeout(()=>p(""),3e3)}},V=async s=>{t(a=>({...a,[s.id]:!0}));try{await g(`/api/stats/achievements/${s.id}`,{method:"PUT",body:{points_reward:s.points_reward}})}catch{}finally{t(a=>({...a,[s.id]:!1}))}},E=({enabled:s,onChange:a,label:i})=>e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("span",{className:"text-cream text-sm",children:i}),e.jsx("button",{onClick:()=>a(!s),className:`relative inline-flex h-6 w-11 items-center rounded-full border transition-colors flex-shrink-0 ${s?"bg-sky/30 border-sky/40":"bg-navy border-border"}`,"aria-label":`Toggle ${i}`,children:e.jsx("span",{className:`inline-block h-4 w-4 rounded-full transition-transform ${s?"translate-x-6 bg-sky":"translate-x-1 bg-muted/60"}`})})]});return e.jsxs("div",{className:"w-full max-w-2xl mx-auto overflow-hidden",children:[e.jsxs("button",{onClick:()=>j("/profile"),className:"flex items-center gap-1.5 text-muted hover:text-cream transition-colors mb-4 text-sm",children:[e.jsx(R,{size:16}),"Profile"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(U,{size:24,className:"text-cream"}),e.jsx("h1",{className:"text-cream text-lg font-bold",children:"Family Settings"})]}),u&&e.jsxs("div",{className:"game-panel p-8 text-center",children:[e.jsx(L,{size:48,className:"text-crimson/30 mx-auto mb-4"}),e.jsx("p",{className:"text-crimson text-sm",children:u}),e.jsx("p",{className:"text-muted text-xs mt-2",children:"Only guild leaders may alter the realm's configuration."})]}),N&&!u&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(f,{size:32,className:"text-sky animate-spin"})}),!N&&!u&&o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"game-panel p-4",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Feature Toggles"}),e.jsxs("div",{className:"divide-y divide-border",children:[e.jsx(E,{enabled:o.leaderboard_enabled??!0,onChange:s=>z("leaderboard_enabled",s),label:"Leaderboard"}),e.jsx(E,{enabled:o.spin_wheel_enabled??!0,onChange:s=>z("spin_wheel_enabled",s),label:"Spin Wheel"}),e.jsx(E,{enabled:o.chore_trading_enabled??!0,onChange:s=>z("chore_trading_enabled",s),label:"Chore Trading"})]})]}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Daily Reset Hour"}),e.jsx("p",{className:"text-muted text-xs mb-3",children:"Hour of day (0-23) when daily quests reset."}),e.jsx("input",{type:"number",min:0,max:23,value:o.daily_reset_hour??0,onChange:s=>{const a=Math.min(23,Math.max(0,parseInt(s.target.value,10)||0));z("daily_reset_hour",a)},className:"field-input max-w-[120px]"})]}),e.jsxs("button",{onClick:O,disabled:h,className:"game-btn game-btn-blue flex items-center gap-2",children:[h?e.jsx(f,{size:14,className:"animate-spin"}):e.jsx(F,{size:14}),h?"Saving...":"Save Settings"]}),b&&e.jsx("p",{className:`text-sm ${b.includes("!")?"text-emerald":"text-crimson"}`,children:b}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("h2",{className:"text-cream text-base font-bold mb-3 flex items-center gap-2",children:[e.jsx(W,{size:16,className:"text-muted"}),"Achievement Point Values"]}),A?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(f,{size:20,className:"text-sky animate-spin"})}):S.length===0?e.jsx("p",{className:"text-muted text-xs",children:"No achievements configured yet."}):e.jsx("div",{className:"space-y-3",children:S.map(s=>{const i={bronze:"text-amber-500 bg-amber-600/10 border-amber-600/30",silver:"text-slate-300 bg-slate-300/10 border-slate-300/30",gold:"text-yellow-400 bg-yellow-400/10 border-yellow-400/30"}[s.tier]||"";return e.jsxs("div",{className:"p-3 rounded-lg bg-surface-raised/30 border border-border space-y-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-cream text-sm truncate",children:s.title||s.name}),s.tier&&e.jsx("span",{className:`text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded-full border ${i}`,children:s.tier})]}),s.description&&e.jsx("p",{className:"text-muted text-xs",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:0,value:s.points_reward??0,onChange:r=>{const M=parseInt(r.target.value,10)||0;m(I=>I.map(T=>T.id===s.id?{...T,points_reward:M}:T))},className:"field-input !w-20 !p-2 text-center"}),e.jsx("span",{className:"text-muted text-xs",children:"pts"}),e.jsx("button",{onClick:()=>V(s),disabled:x[s.id],className:"game-btn game-btn-blue !py-2 !px-3 ml-auto",title:"Save",children:x[s.id]?e.jsx(f,{size:12,className:"animate-spin"}):e.jsx(F,{size:12})})]})]},s.id)})})]}),e.jsx(J,{}),(l==null?void 0:l.role)==="admin"&&e.jsxs("div",{className:"game-panel p-4 text-center",children:[e.jsx("p",{className:"text-muted text-xs mb-3",children:"Need advanced controls?"}),e.jsxs("button",{onClick:()=>j("/admin"),className:"game-btn game-btn-purple",children:[e.jsx(L,{size:14,className:"inline mr-2"}),"Admin Dashboard"]})]})]})]})}export{ee as default};
