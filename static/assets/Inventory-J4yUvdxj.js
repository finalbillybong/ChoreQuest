import{u as L,r as c,c as y,j as e,P as w,G as E,i as P}from"./index-CozlsxUV.js";import{L as z}from"./loader-circle-iSei1Z8b.js";import{C as F}from"./clock-DvTN8P3j.js";function _(){const{user:n}=L(),r=(n==null?void 0:n.role)==="kid",[g,j]=c.useState([]),[m,i]=c.useState(!0),[u,f]=c.useState(""),[k,v]=c.useState(null),x=c.useCallback(async()=>{i(!0),f("");try{const s=await y("/api/rewards/redemptions");j(s)}catch(s){f(s.message||"Failed to load inventory")}finally{i(!1)}},[]);c.useEffect(()=>{x()},[x]),c.useEffect(()=>{const s=()=>{x()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[x]);const C=async s=>{v(s.id);try{await y(`/api/rewards/redemptions/${s.id}/fulfill`,{method:"POST"}),await x()}catch(t){f(t.message||"Could not mark as given")}finally{v(null)}},l=g.filter(s=>s.status==="approved"),d=g.filter(s=>s.status==="pending"),b=s=>{var a,N;const t={};for(const o of s){const p=((a=o.user)==null?void 0:a.display_name)||((N=o.user)==null?void 0:N.username)||`Kid #${o.user_id}`;t[p]||(t[p]=[]),t[p].push(o)}return Object.entries(t).sort(([o],[p])=>o.localeCompare(p))};return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(w,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:r?"My Inventory":"Reward Inventory"})]}),u&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:u}),m&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(z,{size:32,className:"text-sky animate-spin"})}),!m&&e.jsxs(e.Fragment,{children:[l.length===0&&d.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(w,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:r?"No loot yet!":"No claimed rewards"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:r?"Complete quests, earn XP, and redeem rewards to fill your inventory.":"When kids redeem rewards, they'll appear here."})]}),r&&(l.length>0||d.length>0)&&e.jsxs("div",{className:"space-y-6",children:[l.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-[11px] font-semibold uppercase tracking-widest mb-3",children:"Ready to collect"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:l.map(s=>e.jsx(h,{redemption:s,status:"approved"},s.id))})]}),d.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-[11px] font-semibold uppercase tracking-widest mb-3",children:"Awaiting approval"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:d.map(s=>e.jsx(h,{redemption:s,status:"pending"},s.id))})]})]}),!r&&(l.length>0||d.length>0)&&e.jsxs("div",{className:"space-y-6",children:[l.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-[11px] font-semibold uppercase tracking-widest mb-3",children:"Waiting to be given out"}),b(l).map(([s,t])=>e.jsxs("div",{className:"mb-5",children:[e.jsx("p",{className:"text-cream text-sm font-bold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:t.map(a=>e.jsx(h,{redemption:a,status:"approved",showFulfill:!0,onFulfill:()=>C(a),fulfilling:k===a.id},a.id))})]},s))]}),d.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-[11px] font-semibold uppercase tracking-widest mb-3",children:"Pending approval"}),b(d).map(([s,t])=>e.jsxs("div",{className:"mb-5",children:[e.jsx("p",{className:"text-cream text-sm font-bold mb-2",children:s}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:t.map(a=>e.jsx(h,{redemption:a,status:"pending"},a.id))})]},s))]})]})]})]})}function h({redemption:n,status:r,showFulfill:g,onFulfill:j,fulfilling:m}){const i=n.reward,u=(i==null?void 0:i.icon)||"üéÅ";return e.jsxs("div",{className:`game-panel !border-2 p-4 flex items-center gap-3 ${r==="approved"?"border-emerald/40 bg-emerald/5":"border-border bg-surface-raised/30"}`,children:[e.jsx("div",{className:"text-2xl flex-shrink-0",children:u}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream text-sm font-bold truncate",children:(i==null?void 0:i.title)||"Reward"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r==="approved"?e.jsxs("span",{className:"flex items-center gap-1 text-emerald text-xs",children:[e.jsx(E,{size:12})," Approved"]}):e.jsxs("span",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx(F,{size:12})," Pending"]}),e.jsxs("span",{className:"text-muted text-xs",children:[n.points_spent," XP"]})]}),n.created_at&&e.jsxs("p",{className:"text-muted/60 text-[10px] mt-1",children:["Claimed ",new Date(n.created_at).toLocaleDateString()]})]}),g&&e.jsxs("button",{onClick:j,disabled:m,className:"game-btn game-btn-blue flex items-center gap-1 text-xs !py-1.5 !px-3 flex-shrink-0",title:"Mark as given out",children:[e.jsx(P,{size:14}),m?"...":"Given"]})]})}export{_ as default};
