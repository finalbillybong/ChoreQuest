import{u as $,r,b as y,j as e,e as W,U as _,A as C,f as E,S as U}from"./index-DyDiUpYc.js";import{R as q,P as H}from"./PetLevelBadge-0X5BNn5M.js";import{M as T,P as z}from"./pin-C3NgRGch.js";import{S as B}from"./send-Bc8BamdM.js";import{A as X}from"./index-ENwDjcP0.js";import{m as G}from"./proxy-B2dJm0uC.js";import{S as A}from"./star-CIYm8Jtg.js";import{F as D}from"./flame-BR6AwHEh.js";import{P as J}from"./plus-Dj6ox8SW.js";import{T as Y}from"./trash-2-BuaqhUTT.js";import"./shield-B4u7glZ9.js";const F=[{id:"star",label:"Star",icon:"‚≠ê"},{id:"fire",label:"Fire",icon:"üî•"},{id:"heart",label:"Heart",icon:"‚ù§Ô∏è"},{id:"trophy",label:"Trophy",icon:"üèÜ"},{id:"clap",label:"Clap",icon:"üëè"},{id:"muscle",label:"Strong",icon:"üí™"}];function K(l){if(!l)return"";const i=Date.now()-new Date(l).getTime(),a=Math.floor(i/6e4);if(a<1)return"just now";if(a<60)return`${a}m ago`;const c=Math.floor(a/60);return c<24?`${c}h ago`:`${Math.floor(c/24)}d ago`}function Q({members:l}){const{user:i}=$(),[a,c]=r.useState([]),[h,f]=r.useState(!1),[n,m]=r.useState(""),[d,g]=r.useState(""),[o,x]=r.useState("star"),[v,w]=r.useState(!1),u=r.useCallback(async()=>{try{const t=await y("/api/shoutouts");c(t)}catch{}},[]);r.useEffect(()=>{u()},[u]),r.useEffect(()=>{const t=b=>{var j;((j=b.detail)==null?void 0:j.type)==="shoutout"&&u()};return window.addEventListener("ws:message",t),()=>window.removeEventListener("ws:message",t)},[u]);const N=async()=>{if(!(!n||!d.trim())){w(!0);try{await y("/api/shoutouts",{method:"POST",body:{to_user_id:parseInt(n),message:d.trim(),emoji:o}}),g(""),f(!1),u()}catch{}finally{w(!1)}}},S=(l||[]).filter(t=>t.id!==(i==null?void 0:i.id)),k=t=>{var b;return((b=F.find(j=>j.id===t))==null?void 0:b.icon)||"‚≠ê"};return e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-cream text-sm font-bold flex items-center gap-2",children:[e.jsx(T,{size:14,className:"text-gold"}),"Shoutouts"]}),e.jsx("button",{onClick:()=>f(t=>!t),className:"text-xs text-sky hover:text-accent-light transition-colors font-medium",children:h?"Cancel":"+ Give Shoutout"})]}),h&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-surface-raised/50 border border-border/50 space-y-3",children:[e.jsxs("select",{value:n,onChange:t=>m(t.target.value),className:"field-input text-sm",children:[e.jsx("option",{value:"",children:"Who deserves a shoutout?"}),S.map(t=>e.jsx("option",{value:t.id,children:t.display_name},t.id))]}),e.jsx("input",{type:"text",value:d,onChange:t=>g(t.target.value.slice(0,200)),placeholder:"Great job on your quests!",className:"field-input text-sm",maxLength:200}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[F.map(t=>e.jsx("button",{onClick:()=>x(t.id),className:`w-8 h-8 rounded-lg text-base transition-all ${o===t.id?"bg-sky/20 border border-sky/40 scale-110":"bg-surface-raised border border-border/50 hover:border-border-light"}`,children:t.icon},t.id)),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:N,disabled:v||!n||!d.trim(),className:"game-btn game-btn-blue flex items-center gap-1.5 !py-2 !px-3",children:[v?e.jsx(W,{size:12,className:"animate-spin"}):e.jsx(B,{size:12}),"Send"]})]})]}),a.length===0?e.jsx("p",{className:"text-muted text-sm text-center py-4",children:"No shoutouts yet. Be the first!"}):e.jsx("div",{className:"space-y-2",children:a.slice(0,10).map(t=>e.jsxs("div",{className:"flex items-start gap-2.5 px-3 py-2.5 rounded-lg border border-border/50 bg-surface-raised/20",children:[e.jsx("span",{className:"text-lg flex-shrink-0 mt-0.5",children:k(t.emoji)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-cream text-sm",children:[e.jsx("span",{className:"font-medium",children:t.from_user_name}),e.jsx("span",{className:"text-muted",children:" ‚Üí "}),e.jsx("span",{className:"font-medium",children:t.to_user_name})]}),e.jsx("p",{className:"text-muted text-xs mt-0.5",children:t.message}),e.jsx("p",{className:"text-muted/50 text-[10px] mt-0.5",children:K(t.created_at)})]})]},t.id))})]})}const L=[{id:"wave",icon:"üëã",label:"Wave"},{id:"cheer",icon:"üéâ",label:"Cheer"},{id:"dance",icon:"üï∫",label:"Dance"},{id:"flex",icon:"üí™",label:"Flex"},{id:"sparkle",icon:"‚ú®",label:"Sparkle"},{id:"highfive",icon:"üôå",label:"High Five"}];function V({emote:l,onDone:i}){return e.jsx(G.div,{className:"fixed pointer-events-none text-4xl z-50",style:{left:`${30+Math.random()*40}%`},initial:{opacity:1,y:0,bottom:"15%"},animate:{opacity:0,y:-200},transition:{duration:2,ease:"easeOut"},onAnimationComplete:i,children:l.icon})}function Z(){const[l,i]=r.useState([]),[a,c]=r.useState(!1);r.useEffect(()=>{const n=m=>{var d;if(((d=m.detail)==null?void 0:d.type)==="emote"){const g=L.find(o=>{var x;return o.id===((x=m.detail.data)==null?void 0:x.emote)});if(g){const o=Date.now()+Math.random();i(x=>[...x,{...g,key:o,userName:m.detail.data.user_name}])}}};return window.addEventListener("ws:message",n),()=>window.removeEventListener("ws:message",n)},[]);const h=async n=>{if(a)return;c(!0),setTimeout(()=>c(!1),1500);try{await y("/api/emotes",{method:"POST",body:{emote:n.id}})}catch{}const m=Date.now()+Math.random();i(d=>[...d,{...n,key:m,userName:"You"}])},f=n=>{i(m=>m.filter(d=>d.key!==n))};return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:l.map(n=>e.jsx(V,{emote:n,onDone:()=>f(n.key)},n.key))}),e.jsx("div",{className:"flex items-center gap-1.5 justify-center",children:L.map(n=>e.jsx("button",{onClick:()=>h(n),disabled:a,className:`w-9 h-9 rounded-lg text-lg transition-all hover:scale-110 active:scale-95 bg-surface-raised border border-border/50 hover:border-border-light ${a?"opacity-50 cursor-not-allowed":""}`,title:n.label,children:n.icon},n.id))})]})}function M(l){if(!l)return"";const i=Date.now()-new Date(l).getTime(),a=Math.floor(i/6e4);if(a<1)return"just now";if(a<60)return`${a}m ago`;const c=Math.floor(a/60);return c<24?`${c}h ago`:`${Math.floor(c/24)}d ago`}function ee({completed:l,total:i,size:a=72}){const c=(a-8)/2,h=2*Math.PI*c,f=i>0?l/i:0,n=h*(1-f);return e.jsxs("svg",{width:a,height:a,className:"absolute inset-0",children:[e.jsx("circle",{cx:a/2,cy:a/2,r:c,fill:"none",stroke:"currentColor",strokeWidth:"3",className:"text-border/30"}),i>0&&e.jsx("circle",{cx:a/2,cy:a/2,r:c,fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeDasharray:h,strokeDashoffset:n,className:f>=1?"text-emerald":"text-sky",transform:`rotate(-90 ${a/2} ${a/2})`})]})}function xe(){const{user:l}=$(),i=(l==null?void 0:l.role)==="parent"||(l==null?void 0:l.role)==="admin",[a,c]=r.useState(null),[h,f]=r.useState(!0),[n,m]=r.useState([]),[d,g]=r.useState(!1),[o,x]=r.useState({title:"",message:"",is_pinned:!1}),[v,w]=r.useState(!1),u=r.useCallback(async()=>{try{const s=await y("/api/announcements");m(Array.isArray(s)?s:[])}catch{m([])}},[]),N=r.useCallback(async()=>{try{const s=await y("/api/stats/party");c(s)}catch{c(null)}},[]);r.useEffect(()=>{Promise.all([N(),u()]).finally(()=>f(!1))},[N,u]),r.useEffect(()=>{const s=()=>{N(),u()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[N,u]);const S=async()=>{if(!(!o.title.trim()||!o.message.trim())){w(!0);try{await y("/api/announcements",{method:"POST",body:o}),x({title:"",message:"",is_pinned:!1}),g(!1),await u()}catch{}finally{w(!1)}}},k=async s=>{try{await y(`/api/announcements/${s}`,{method:"DELETE"}),m(p=>p.filter(R=>R.id!==s))}catch{}};if(h)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(_,{size:48,className:"text-purple animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Assembling the party..."})]});if(!a)return e.jsxs("div",{className:"text-center py-20 text-muted",children:[e.jsx(_,{size:48,className:"mx-auto mb-3 opacity-40"}),e.jsx("p",{className:"text-sm",children:"Could not load party data."})]});const{members:t,activity:b,family_streak:j,family_total_xp:I}=a,O=t.filter(s=>s.role==="kid"),P=t.filter(s=>s.role!=="kid");return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h1",{className:"font-heading text-cream text-lg font-extrabold flex items-center gap-2",children:[e.jsx(_,{size:20,className:"text-purple"}),"The Party"]}),e.jsxs("div",{className:"flex items-center gap-1 text-gold text-sm font-bold",children:[e.jsx(A,{size:14,className:"fill-gold"}),I.toLocaleString()," XP"]})]}),j>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 px-3 py-2 rounded-lg bg-crimson/10 border border-crimson/20",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(D,{size:16,className:"text-crimson flex-shrink-0"}),e.jsxs("span",{className:"text-cream text-sm font-medium",children:["Family Streak: ",j," day",j!==1?"s":""]})]}),e.jsx("span",{className:"text-muted text-xs ml-auto",children:"Everyone completed at least one quest!"})]})]}),e.jsx("div",{className:"game-panel p-3",children:e.jsx(Z,{})}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsx("h2",{className:"text-cream text-sm font-bold mb-3",children:"Heroes"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:O.map(s=>e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[80px]",children:[e.jsxs("div",{className:"relative",style:{width:72,height:72},children:[e.jsx(ee,{completed:s.today_completed||0,total:s.today_total||0,size:72}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(C,{config:s.avatar_config,size:"md",name:s.display_name,animate:!0})})]}),e.jsx("span",{className:"text-cream text-sm font-medium text-center leading-tight",children:s.display_name}),s.rank&&e.jsx(q,{rank:s.rank,size:"sm"}),e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold text-xs font-bold",children:[e.jsx(A,{size:10,className:"fill-gold"}),s.points_balance," XP"]}),e.jsxs("span",{className:"text-muted text-[11px]",children:[s.today_completed||0,"/",s.today_total||0," today"]}),s.current_streak>0&&e.jsxs("span",{className:"flex items-center gap-0.5 text-crimson text-[11px]",children:[e.jsx(D,{size:10}),s.current_streak,"d streak"]}),s.pet&&e.jsx(H,{pet:s.pet,compact:!0})]})]},s.id))}),P.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-border/50 my-3"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:P.map(s=>e.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[e.jsx(C,{config:s.avatar_config,size:"md",name:s.display_name,animate:!0}),e.jsx("span",{className:"text-cream text-sm font-medium",children:s.display_name}),e.jsx("span",{className:"text-muted text-[11px] capitalize",children:s.role})]},s.id))})]})]}),e.jsx(Q,{members:t}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-cream text-sm font-bold flex items-center gap-2",children:[e.jsx(T,{size:14,className:"text-sky"}),"Bulletin Board"]}),i&&e.jsxs("button",{onClick:()=>g(s=>!s),className:"text-sky text-xs hover:text-sky/80 flex items-center gap-1",children:[e.jsx(J,{size:12}),"Post"]})]}),i&&d&&e.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-surface-raised/40 border border-border space-y-2",children:[e.jsx("input",{type:"text",value:o.title,onChange:s=>x(p=>({...p,title:s.target.value})),placeholder:"Announcement title",maxLength:200,className:"field-input !text-sm"}),e.jsx("textarea",{value:o.message,onChange:s=>x(p=>({...p,message:s.target.value})),placeholder:"What's the news?",maxLength:1e3,rows:2,className:"field-input !text-sm resize-none"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 text-muted text-xs cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.is_pinned,onChange:s=>x(p=>({...p,is_pinned:s.target.checked})),className:"rounded border-border"}),e.jsx(z,{size:10}),"Pin to top"]}),e.jsxs("button",{onClick:S,disabled:v||!o.title.trim(),className:"game-btn game-btn-blue !py-1.5 !px-3 flex items-center gap-1 text-xs",children:[e.jsx(B,{size:12}),v?"Posting...":"Post"]})]})]}),n.length===0?e.jsx("p",{className:"text-muted text-sm text-center py-4",children:"No announcements yet."}):e.jsx("div",{className:"space-y-2",children:n.map(s=>e.jsx("div",{className:`px-3 py-2.5 rounded-lg border ${s.is_pinned?"border-sky/30 bg-sky/5":"border-border/50 bg-surface-raised/20"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[s.is_pinned&&e.jsx(z,{size:10,className:"text-sky flex-shrink-0"}),e.jsx("p",{className:"text-cream text-sm font-medium truncate",children:s.title})]}),e.jsx("p",{className:"text-muted text-xs mt-1",children:s.message}),e.jsxs("p",{className:"text-muted/50 text-[10px] mt-1",children:[s.creator_name&&e.jsxs("span",{children:[s.creator_name," ¬∑ "]}),M(s.created_at)]})]}),i&&e.jsx("button",{onClick:()=>k(s.id),className:"p-1 text-muted hover:text-crimson transition-colors flex-shrink-0",title:"Delete",children:e.jsx(Y,{size:12})})]})},s.id))})]}),e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("h2",{className:"text-cream text-sm font-bold mb-3 flex items-center gap-2",children:[e.jsx(E,{size:14,className:"text-gold"}),"Recent Activity"]}),b.length===0?e.jsx("p",{className:"text-muted text-sm text-center py-6",children:"No activity yet. Complete some quests!"}):e.jsx("div",{className:"space-y-2",children:b.map((s,p)=>e.jsxs("div",{className:"flex items-start gap-3 px-3 py-2.5 rounded-lg border border-border/50 bg-surface-raised/20",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0",children:s.type==="avatar_drop"?e.jsx(E,{size:14,className:"text-purple"}):e.jsx(U,{size:14,className:"text-sky"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-cream text-sm",children:[e.jsx("span",{className:"font-medium",children:s.user_name})," ",s.type==="avatar_drop"?e.jsx("span",{className:"text-purple",children:s.description}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted",children:s.description}),s.xp&&e.jsxs("span",{className:"text-gold font-bold ml-1",children:["+",s.xp," XP"]})]})]}),e.jsx("p",{className:"text-muted/60 text-xs mt-0.5",children:M(s.timestamp)})]})]},p))})]})]})}export{xe as default};
