import{r as l,b as y,j as e,A as Ce,u as we,c as Se,a as ke,S as Z,d as _e}from"./index-D3Jwi99H.js";import{t as Ae,a as Ee}from"./questThemeText-Y6jOZcFn.js";import{M as V}from"./Modal-CKyPv24p.js";import{B as Te,C as ze,a as qe,F as De,S as Pe}from"./search-hxvlYFOB.js";import{S as J}from"./star-9suZJ_2G.js";import{U as W}from"./users-BoBi3fyU.js";import{C as G}from"./camera-Cj7D5N9R.js";import{R as Fe,a as $e}from"./rotate-cw-sQQI1N9q.js";import{E as Qe,a as Le}from"./eye-BhjKW3xU.js";import{P as xe}from"./plus-DOoGCNeD.js";import{S as Re}from"./scroll-text-BUENR-B2.js";import{Z as Me}from"./zap-D3nk9Y0E.js";import{P as Oe}from"./pencil-B1TbSJ-X.js";import{T as Ie}from"./trash-2-ghOREQCp.js";import{C as pe}from"./circle-check-Cb7DY4i_.js";import"./index-CoJrSUtZ.js";import"./proxy-BK6E2-vq.js";const Ke=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],fe="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors",he={title:"",description:"",points:10,difficulty:"easy",category_id:""};function Ue({isOpen:r,onClose:d,onCreated:b,categories:i,editingChore:n}){const[m,j]=l.useState({...he}),[q,w]=l.useState(""),[S,E]=l.useState(!1),[D,P]=l.useState([]),[T,z]=l.useState(!1);l.useEffect(()=>{r&&(j(n?{title:n.title||"",description:n.description||"",points:n.points||10,difficulty:n.difficulty||"easy",category_id:n.category_id?String(n.category_id):""}:{...he}),w(""),z(!1))},[r,n]),l.useEffect(()=>{r&&!n&&y("/api/chores/templates").then(s=>P(Array.isArray(s)?s:[])).catch(()=>P([]))},[r,n]);const v=(s,f)=>{j(p=>({...p,[s]:f}))},N=s=>{const f=i.find(p=>p.name.toLowerCase()===s.category_name.toLowerCase());j({title:s.title,description:s.description||"",points:s.suggested_points,difficulty:s.difficulty,category_id:f?String(f.id):""}),z(!1)},k=async()=>{if(!m.title.trim()){w("Every quest needs a name, adventurer!");return}if(m.points<1){w("The reward must be at least 1 XP.");return}if(!m.category_id){w("Please select a category for this quest.");return}E(!0),w("");const s={title:m.title.trim(),description:m.description.trim()||null,points:Number(m.points),difficulty:m.difficulty,category_id:Number(m.category_id),recurrence:"once",requires_photo:!1,assigned_user_ids:[]};try{n?await y(`/api/chores/${n.id}`,{method:"PUT",body:s}):await y("/api/chores",{method:"POST",body:s}),b(),d()}catch(f){w(f.message||"The quest scroll could not be saved.")}finally{E(!1)}},F=D.reduce((s,f)=>{const p=f.category_name||"Other";return s[p]||(s[p]=[]),s[p].push(f),s},{});return e.jsx(V,{isOpen:r,onClose:d,title:n?"Edit Quest Scroll":"New Quest Scroll",actions:[{label:"Cancel",onClick:d,className:"game-btn game-btn-blue"},{label:S?"Saving...":n?"Update Quest":"Create Quest",onClick:k,className:"game-btn game-btn-gold",disabled:S}],children:e.jsxs("div",{className:"space-y-4",children:[q&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:q}),!n&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>z(!T),className:"flex items-center gap-2 text-sky text-sm hover:text-sky/80 transition-colors",children:[e.jsx(Te,{size:14}),T?"Hide templates":"Choose from Quest Templates"]}),T&&e.jsxs("div",{className:"mt-3 max-h-60 overflow-y-auto space-y-3 border border-border rounded-lg p-3 bg-surface-raised/30",children:[Object.entries(F).map(([s,f])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-bold uppercase tracking-wider mb-1",children:s}),e.jsx("div",{className:"space-y-1",children:f.map(p=>e.jsxs("button",{onClick:()=>N(p),className:"w-full text-left px-3 py-2 rounded-lg hover:bg-surface-raised transition-colors border border-transparent hover:border-sky/30",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-cream text-sm font-medium",children:p.title}),e.jsxs("span",{className:"flex items-center gap-1 text-gold text-xs",children:[e.jsx(J,{size:10,className:"fill-gold"}),p.suggested_points," XP"]})]}),p.description&&e.jsx("p",{className:"text-muted text-xs line-clamp-1 mt-0.5",children:p.description})]},p.id))})]},s)),D.length===0&&e.jsx("p",{className:"text-muted text-xs text-center py-3",children:"No templates available yet."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Quest Name"}),e.jsx("input",{type:"text",value:m.title,onChange:s=>v("title",s.target.value),placeholder:"Defeat the Dust Bunnies",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Description"}),e.jsx("textarea",{value:m.description,onChange:s=>v("description",s.target.value),placeholder:"Describe the quest details...",rows:3,className:"field-input resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"XP Reward"}),e.jsx("input",{type:"number",min:1,value:m.points,onChange:s=>v("points",s.target.value),className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Difficulty"}),e.jsx("select",{value:m.difficulty,onChange:s=>v("difficulty",s.target.value),className:`${fe} w-full p-3`,children:Ke.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream text-sm font-medium mb-1 tracking-wide",children:"Category"}),e.jsxs("select",{value:m.category_id,onChange:s=>v("category_id",s.target.value),className:`${fe} w-full p-3`,children:[e.jsx("option",{value:"",children:"Select category..."}),i.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]})})}const He=[{value:"once",label:"One-time"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"custom",label:"Custom Days"}],Be=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"fortnightly",label:"Fortnightly"},{value:"monthly",label:"Monthly"}],We=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ge="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors";function Xe({isOpen:r,onClose:d,onAssigned:b,chore:i,kids:n}){const[m,j]=l.useState({}),[q,w]=l.useState(null),[S,E]=l.useState(!1),[D,P]=l.useState("weekly"),[T,z]=l.useState(!1),[v,N]=l.useState(""),[k,F]=l.useState([]);l.useEffect(()=>{!r||!i||!n.length||(y(`/api/chores/${i.id}/rules`).then(a=>{F(Array.isArray(a)?a:[]);const o={};for(const u of n){const c=(Array.isArray(a)?a:[]).find(g=>g.user_id===u.id&&g.is_active);o[u.id]=c?{selected:!0,recurrence:c.recurrence||"daily",custom_days:c.custom_days||[],requires_photo:c.requires_photo||!1}:{selected:!1,recurrence:"daily",custom_days:[],requires_photo:!1}}j(o)}).catch(()=>{const a={};for(const o of n)a[o.id]={selected:!1,recurrence:"daily",custom_days:[],requires_photo:!1};j(a),F([])}),E(!1),P("weekly"),N(""))},[r,i,n]);const s=Object.entries(m).filter(([,a])=>a.selected),f=s.length,p=a=>{j(o=>{var u;return{...o,[a]:{...o[a],selected:!((u=o[a])!=null&&u.selected)}}})},I=(a,o,u)=>{j(c=>({...c,[a]:{...c[a],[o]:u}}))},R=(a,o)=>{j(u=>{var g;const c=((g=u[a])==null?void 0:g.custom_days)||[];return{...u,[a]:{...u[a],custom_days:c.includes(o)?c.filter(_=>_!==o):[...c,o]}}})},X=async()=>{if(f===0){N("Select at least one hero to assign this quest to.");return}z(!0),N("");const o={assignments:s.map(([u,c])=>({user_id:Number(u),recurrence:c.recurrence,custom_days:c.recurrence==="custom"?c.custom_days:null,requires_photo:c.requires_photo}))};S&&f>=2&&(o.rotation={enabled:!0,cadence:D});try{await y(`/api/chores/${i.id}/assign`,{method:"POST",body:o}),b(),d()}catch(u){N(u.message||"Failed to assign quest.")}finally{z(!1)}};return i?e.jsx(V,{isOpen:r,onClose:d,title:"Quest Assignment Scroll",actions:[{label:"Cancel",onClick:d,className:"game-btn game-btn-blue"},{label:T?"Assigning...":"Assign Quest",onClick:X,className:"game-btn game-btn-gold",disabled:T||f===0}],children:e.jsxs("div",{className:"space-y-4",children:[v&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:v}),e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/30",children:[e.jsx("h3",{className:"text-cream font-bold text-base",children:i.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold text-sm font-bold",children:[e.jsx(J,{size:12,className:"fill-gold"}),i.points," XP"]}),e.jsx("span",{className:"text-muted text-xs capitalize",children:i.difficulty}),i.category&&e.jsx("span",{className:"text-muted text-xs",children:i.category.name||i.category})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-cream text-sm font-medium mb-2",children:[e.jsx(W,{size:14}),"Select Heroes"]}),e.jsx("div",{className:"space-y-2",children:n.map(a=>{const o=m[a.id];if(!o)return null;const u=o.selected,c=q===a.id&&u;return e.jsxs("div",{className:`rounded-lg border transition-colors ${u?"border-sky/40 bg-sky/5":"border-border"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 p-3",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>p(a.id),className:"w-4 h-4 accent-sky flex-shrink-0"}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Ce,{config:a.avatar_config,size:"xs",name:a.display_name||a.username}),e.jsx("span",{className:"text-cream text-sm font-medium truncate",children:a.display_name||a.username})]}),u&&e.jsx("button",{type:"button",onClick:()=>w(c?null:a.id),className:"p-1 rounded hover:bg-surface-raised text-muted hover:text-cream transition-colors",children:c?e.jsx(ze,{size:16}):e.jsx(qe,{size:16})})]}),c&&e.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border/50 pt-3 ml-7",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Recurrence"}),e.jsx("select",{value:o.recurrence,onChange:g=>I(a.id,"recurrence",g.target.value),className:`${ge} w-full`,children:He.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))})]}),o.recurrence==="custom"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Quest Days"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:We.map((g,_)=>e.jsx("button",{type:"button",onClick:()=>R(a.id,_),className:`px-2 py-1 rounded border text-xs transition-colors ${o.custom_days.includes(_)?"border-sky bg-sky/20 text-sky":"border-border text-muted hover:border-cream/30"}`,children:g},g))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-muted text-xs font-medium flex items-center gap-1.5",children:[e.jsx(G,{size:12}),"Photo Proof"]}),e.jsx("button",{type:"button",onClick:()=>I(a.id,"requires_photo",!o.requires_photo),className:`relative w-10 h-5 rounded-full border-2 transition-colors ${o.requires_photo?"bg-sky/20 border-sky":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-3.5 h-3.5 rounded-full transition-all ${o.requires_photo?"left-5 bg-sky":"left-0.5 bg-muted"}`})})]})]})]},a.id)})})]}),f>=2&&e.jsxs("div",{className:"p-3 rounded-lg border border-border bg-surface-raised/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-cream text-sm font-medium flex items-center gap-2",children:[e.jsx(Fe,{size:14}),"Kid Rotation"]}),e.jsx("button",{type:"button",onClick:()=>E(!S),className:`relative w-12 h-6 rounded-full border-2 transition-colors ${S?"bg-purple/20 border-purple":"bg-navy-light border-border"}`,children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 rounded-full transition-all ${S?"left-6 bg-purple":"left-0.5 bg-muted"}`})})]}),S&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-muted text-xs font-medium mb-1",children:"Rotation Cadence"}),e.jsx("select",{value:D,onChange:a=>P(a.target.value),className:`${ge} w-full`,children:Be.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("p",{className:"text-muted text-xs mt-1",children:"The quest will rotate between the selected heroes on this schedule."})]})]})]})}):null}const Ye=[{value:"easy",label:"Easy",level:1},{value:"medium",label:"Medium",level:2},{value:"hard",label:"Hard",level:3},{value:"expert",label:"Expert",level:4}],Ze={easy:1,medium:2,hard:3,expert:4},Ge=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],be="bg-navy-light border-2 border-border text-cream p-2 rounded text-sm focus:border-sky focus:outline-none transition-colors";function Ve({level:r}){const d=typeof r=="string"?Ze[r]||1:r||1;return e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4].map(b=>e.jsx(J,{size:14,className:b<=d?"text-gold fill-gold":"text-muted"},b))})}function Je({category:r}){const d=typeof r=="object"?r==null?void 0:r.name:r;return e.jsx("span",{className:"inline-block px-2 py-0.5 rounded-full text-xs border bg-cream/10 text-muted border-border capitalize",children:d||"General"})}function et({recurrence:r,customDays:d}){return!r||r==="once"?null:e.jsxs("div",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx($e,{size:12}),e.jsx("span",{className:"capitalize",children:r}),r==="custom"&&(d==null?void 0:d.length)>0&&e.jsxs("span",{className:"text-muted",children:["(",d.map(b=>Ge[b]||b).join(", "),")"]})]})}function tt(){const r=new Date,d=r.getDay(),b=d===0?-6:1-d,i=new Date(r);return i.setDate(r.getDate()+b),i.toISOString().slice(0,10)}function st(){return new Date().toISOString().slice(0,10)}function vt(){var me;const{user:r}=we(),{colorTheme:d}=Se(),b=ke(),i=(r==null?void 0:r.role)==="parent"||(r==null?void 0:r.role)==="admin",n=(r==null?void 0:r.role)==="kid",[m,j]=l.useState([]),[q,w]=l.useState([]),[S,E]=l.useState([]),[D,P]=l.useState([]),[T,z]=l.useState(!0),[v,N]=l.useState(""),[k,F]=l.useState("library"),[s,f]=l.useState(""),[p,I]=l.useState(""),[R,X]=l.useState(""),[a,o]=l.useState(!1),[u,c]=l.useState(!1),[g,_]=l.useState(null),[ee,K]=l.useState(null),[M,U]=l.useState(null),[te,se]=l.useState(!1),[ye,ae]=l.useState(null),[$,le]=l.useState({}),Q=l.useCallback(async()=>{try{N("");const t=await y("/api/chores");j(Array.isArray(t)?t:t.chores||t.items||[])}catch(t){N(t.message||"Failed to load quests from the guild board.")}},[]),H=l.useCallback(async()=>{if(n)try{const t=tt(),x=st(),h=await y(`/api/calendar?week_start=${t}`),A=h.days&&h.days[x]||[];P(A)}catch{}},[n]),re=l.useCallback(async()=>{try{const t=await y("/api/chores/categories");w(Array.isArray(t)?t:t.categories||[])}catch{}},[]),ie=l.useCallback(async()=>{if(i)try{const t=await y("/api/stats/family");E(Array.isArray(t)?t:[])}catch{try{const t=await y("/api/admin/users"),x=Array.isArray(t)?t:t.users||[];E(x.filter(h=>h.role==="kid"))}catch{}}},[i]),Y=l.useCallback(async()=>{await Promise.all([Q(),H(),re(),ie()])},[Q,H,re,ie]);l.useEffect(()=>{Y().finally(()=>z(!1))},[Y]),l.useEffect(()=>{const t=()=>{Q(),H()};return window.addEventListener("ws:message",t),()=>window.removeEventListener("ws:message",t)},[Q,H]);const je=async t=>{const x=t.id;if(!(t.requires_photo&&!$[x])){ae(x);try{if(t.requires_photo&&$[x]){const h=new FormData;h.append("file",$[x]),await y(`/api/chores/${x}/complete`,{method:"POST",body:h})}else await y(`/api/chores/${x}/complete`,{method:"POST"});le(h=>{const A={...h};return delete A[x],A}),await Y()}catch(h){N(h.message||"Failed to complete quest")}finally{ae(null)}}},B={};if(n)for(const t of D){const x=t.chore_id||((me=t.chore)==null?void 0:me.id);x&&(B[x]=t.status)}const ne=m,oe=m.filter(t=>(t.assignment_count||0)>0),ce=(i?k==="library"?ne:oe:m).filter(t=>{var x,h,A;if(s&&((x=t.category)==null?void 0:x.name)!==s||p&&t.difficulty!==p||R&&!((h=t.title)!=null&&h.toLowerCase().includes(R.toLowerCase()))&&!((A=t.description)!=null&&A.toLowerCase().includes(R.toLowerCase())))return!1;if(n&&!a){const O=B[t.id];if(O==="completed"||O==="verified")return!1}return!0}),de=n?Object.values(B).filter(t=>t==="completed"||t==="verified").length:0,ve=async()=>{if(M){se(!0);try{await y(`/api/chores/${M.id}`,{method:"DELETE"}),U(null),await Q()}catch(t){N(t.message||"Failed to remove the quest.")}finally{se(!1)}}};return T?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[e.jsx(Z,{size:48,className:"text-sky animate-pulse"}),e.jsx("p",{className:"text-cream text-lg font-bold animate-pulse",children:"Loading quests from the guild board..."})]}):e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:i?"Quest Management":"My Quests"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[n&&de>0&&e.jsxs("button",{onClick:()=>o(t=>!t),className:"flex items-center gap-1.5 text-muted hover:text-cream text-sm transition-colors",children:[a?e.jsx(Qe,{size:16}):e.jsx(Le,{size:16}),a?"Hide":"Show"," completed (",de,")"]}),i&&e.jsxs("button",{onClick:()=>{_(null),c(!0)},className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(xe,{size:16}),"Create Quest"]})]})]}),v&&e.jsx("div",{className:"p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:v}),i&&e.jsxs("div",{className:"flex gap-1 bg-surface-raised/50 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>F("library"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${k==="library"?"bg-sky/20 text-sky border border-sky/30":"text-muted hover:text-cream"}`,children:[e.jsx(Re,{size:16}),"Quest Library",e.jsxs("span",{className:"text-xs opacity-70",children:["(",ne.length,")"]})]}),e.jsxs("button",{onClick:()=>F("active"),className:`flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition-colors ${k==="active"?"bg-emerald/20 text-emerald border border-emerald/30":"text-muted hover:text-cream"}`,children:[e.jsx(Me,{size:16}),"Active Quests",e.jsxs("span",{className:"text-xs opacity-70",children:["(",oe.length,")"]})]})]}),e.jsx("div",{className:"game-panel p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted",children:[e.jsx(De,{size:16}),e.jsx("span",{className:"text-sm",children:"Filters:"})]}),e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(Pe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted"}),e.jsx("input",{type:"text",placeholder:"Search quests...",value:R,onChange:t=>X(t.target.value),className:"field-input pl-9 py-2"})]}),e.jsxs("select",{value:s,onChange:t=>f(t.target.value),className:be,children:[e.jsx("option",{value:"",children:"All Categories"}),q.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]}),e.jsxs("select",{value:p,onChange:t=>I(t.target.value),className:be,children:[e.jsx("option",{value:"",children:"All Difficulties"}),Ye.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]})}),ce.length===0?e.jsxs("div",{className:"game-panel p-10 text-center",children:[e.jsx(Z,{size:40,className:"mx-auto text-muted mb-4"}),e.jsx("p",{className:"text-muted text-sm",children:m.length===0?"The quest board is empty. No adventures await... yet!":i&&k==="active"?"No active quests. Assign some from the Quest Library!":"No quests match your search. Try adjusting the filters."}),i&&m.length===0&&e.jsxs("button",{onClick:()=>{_(null),c(!0)},className:"game-btn game-btn-blue mt-4 inline-flex items-center gap-2",children:[e.jsx(xe,{size:16}),"Post First Quest"]})]}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:ce.map(t=>{const x=n?B[t.id]:null,h=x==="completed"||x==="verified",A=n&&(x==="pending"||x==="assigned"),O=ye===t.id,L=t.assignment_count||0;return e.jsxs("div",{className:`game-panel p-4 flex flex-col gap-3 cursor-pointer hover:border-sky/40 transition-colors ${h?"opacity-50":""}`,onClick:()=>{i&&k==="library"&&L===0?K(t):b(`/chores/${t.id}`)},children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"text-cream text-lg font-bold leading-relaxed flex-1",children:Ae(t.title,d)}),i&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),_(t),c(!0)},className:"p-1.5 rounded hover:bg-surface-raised transition-colors text-muted hover:text-sky","aria-label":"Edit quest",children:e.jsx(Oe,{size:14})}),e.jsx("button",{onClick:C=>{C.stopPropagation(),U(t)},className:"p-1.5 rounded hover:bg-surface-raised transition-colors text-muted hover:text-crimson","aria-label":"Delete quest",children:e.jsx(Ie,{size:14})})]}),h&&e.jsx(pe,{size:18,className:"text-emerald flex-shrink-0"})]}),t.description&&e.jsx("p",{className:"text-muted text-sm line-clamp-2",children:Ee(t.title,t.description,d)}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2 mt-auto",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold font-bold text-sm",children:[e.jsx("span",{className:"text-lg",children:"â˜…"}),t.points," XP"]}),e.jsx(Ve,{level:t.difficulty||1})]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx(Je,{category:t.category}),e.jsx(et,{recurrence:t.recurrence,customDays:t.custom_days}),t.requires_photo&&e.jsxs("span",{className:"flex items-center gap-1 text-muted text-xs",children:[e.jsx(G,{size:12}),"Photo"]}),i&&L>0&&e.jsxs("span",{className:"flex items-center gap-1 text-emerald text-xs font-medium",children:[e.jsx(W,{size:12}),L," ",L===1?"hero":"heroes"]}),i&&L===0&&e.jsx("span",{className:"text-muted/60 text-xs italic",children:"Not assigned"})]}),i&&k==="library"&&L===0&&e.jsxs("button",{onClick:C=>{C.stopPropagation(),K(t)},className:"game-btn game-btn-gold w-full flex items-center justify-center gap-2 !text-xs !py-1.5",children:[e.jsx(W,{size:14}),"Assign to Heroes"]}),i&&L>0&&e.jsxs("button",{onClick:C=>{C.stopPropagation(),K(t)},className:"game-btn game-btn-purple w-full flex items-center justify-center gap-2 !text-xs !py-1.5",children:[e.jsx(W,{size:14}),"Manage Assignments"]}),A&&e.jsxs("div",{className:"mt-1 space-y-2",onClick:C=>C.stopPropagation(),children:[t.requires_photo&&e.jsxs("label",{className:"inline-flex items-center gap-1.5 text-xs text-muted cursor-pointer hover:text-cream transition-colors bg-surface-raised px-3 py-1.5 rounded-lg border border-border",children:[e.jsx(G,{size:14}),e.jsx("span",{children:$[t.id]?$[t.id].name:"Attach proof photo"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:C=>le(Ne=>{var ue;return{...Ne,[t.id]:((ue=C.target.files)==null?void 0:ue[0])||null}})})]}),e.jsx("button",{onClick:()=>je(t),disabled:O||t.requires_photo&&!$[t.id],className:`game-btn game-btn-blue w-full flex items-center justify-center gap-2 ${O?"opacity-60 cursor-wait":""} ${t.requires_photo&&!$[t.id]?"opacity-40 cursor-not-allowed":""}`,children:O?e.jsxs(e.Fragment,{children:[e.jsx(_e,{size:14,className:"animate-spin"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14}),"Complete Quest"]})})]})]},t.id)})}),e.jsx(Ue,{isOpen:u,onClose:()=>{c(!1),_(null)},onCreated:Q,categories:q,editingChore:g}),e.jsx(Xe,{isOpen:!!ee,onClose:()=>K(null),onAssigned:()=>{Q()},chore:ee,kids:S}),e.jsx(V,{isOpen:!!M,onClose:()=>U(null),title:"Abandon Quest?",actions:[{label:"Keep Quest",onClick:()=>U(null),className:"game-btn game-btn-blue"},{label:te?"Removing...":"Remove Quest",onClick:ve,className:"game-btn game-btn-red",disabled:te}],children:e.jsxs("p",{className:"text-muted",children:["Are you sure you want to remove the quest"," ",e.jsxs("span",{className:"text-cream text-lg font-bold",children:['"',M==null?void 0:M.title,'"']}),"? This action cannot be undone. All associated records will be archived."]})})]})}export{vt as default};
