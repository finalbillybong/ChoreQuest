import{u as Z,a as ee,r as n,b as o,j as e,A as se}from"./index-CB_w5JI9.js";import{M as te}from"./Modal-ChBeEhJ8.js";import{L as h}from"./loader-circle-CpsAbjaw.js";import{U as ae}from"./users-TF350cKb.js";import{T as ne}from"./triangle-alert-xKvBAEt_.js";import{m as v}from"./proxy-DRhvnLDk.js";import{S as ie}from"./star-sPqbOYMY.js";import{F as re}from"./flame-DgER7lt7.js";import{C as le}from"./camera-Aj8VS4_0.js";import{C as F}from"./circle-check-Bj1FSt91.js";import{C as X}from"./circle-x-flbRRncT.js";import{P as oe}from"./plus-BoiTP9-7.js";import{S as ce}from"./sparkles-Bw-ZTzwq.js";import"./index-BuXrK44w.js";const de={hidden:{opacity:0,y:16},visible:N=>({opacity:1,y:0,transition:{delay:N*.08,type:"spring",stiffness:260,damping:24}})},me={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3}}};function Pe(){const{user:N}=Z(),D=ee(),[u,K]=n.useState([]),[w,L]=n.useState([]),[C,T]=n.useState([]),[V,M]=n.useState(!0),[S,p]=n.useState(null),[f,q]=n.useState({}),[U,g]=n.useState(!1),[y,P]=n.useState(""),[_,A]=n.useState(""),[b,k]=n.useState(""),[z,$]=n.useState(!1),[R,x]=n.useState(""),i=n.useCallback(async()=>{try{p(null);const[s,t,a]=await Promise.all([o("/api/stats/family"),o("/api/rewards/redemptions?status=pending"),o("/api/calendar")]);K(s),L(t);const l=new Date().toISOString().slice(0,10),d=(a.days&&a.days[l]||[]).filter(m=>m.status==="completed");T(d)}catch(s){p(s.message||"Failed to load family data")}finally{M(!1)}},[]);n.useEffect(()=>{i()},[i]),n.useEffect(()=>{const s=()=>{i()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[i]);const r=(s,t)=>{q(a=>({...a,[s]:t}))},G=async s=>{const t=`verify-${s}`;r(t,!0);try{await o(`/api/chores/${s}/verify`,{method:"POST"}),await i()}catch(a){p(a.message||"Failed to verify chore")}finally{r(t,!1)}},I=async s=>{const t=`reject-${s}`;r(t,!0);try{await o(`/api/chores/${s}/uncomplete`,{method:"POST"}),await i()}catch(a){p(a.message||"Failed to reject chore")}finally{r(t,!1)}},Q=async s=>{const t=`approve-${s}`;r(t,!0);try{await o(`/api/rewards/redemptions/${s}/approve`,{method:"POST"}),await i()}catch(a){p(a.message||"Failed to approve redemption")}finally{r(t,!1)}},H=async s=>{const t=`deny-${s}`;r(t,!0);try{await o(`/api/rewards/redemptions/${s}/deny`,{method:"POST"}),await i()}catch(a){p(a.message||"Failed to deny redemption")}finally{r(t,!1)}},J=async()=>{if(x(""),!y){x("Select a kid");return}const s=parseInt(_,10);if(!s||s<=0){x("Enter a positive XP amount");return}if(!b.trim()){x("Enter a description");return}$(!0);try{await o(`/api/points/${y}/bonus`,{method:"POST",body:{amount:s,description:b.trim()}}),P(""),A(""),k(""),g(!1),await i()}catch(t){x(t.message||"Failed to award bonus XP")}finally{$(!1)}};function W({completed:s,total:t}){const a=t>0?Math.round(s/t*100):0;return e.jsx("div",{className:"w-full bg-navy rounded-full h-2.5 overflow-hidden",children:e.jsx(v.div,{className:"h-full bg-emerald rounded-full",initial:{width:0},animate:{width:`${a}%`},transition:{duration:.6,ease:"easeOut"}})})}if(V)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(h,{className:"animate-spin text-gold",size:32})});const Y=w.length>0||C.length>0,j="w-full bg-navy border-2 border-[#2a2a4a] text-cream p-3 rounded font-body text-lg placeholder:text-cream/30 focus:border-gold focus:outline-none transition-colors";return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"font-heading text-gold text-base sm:text-lg leading-relaxed",children:"Family Overview"}),e.jsxs("div",{className:"flex items-center gap-1 text-cream/40",children:[e.jsx(ae,{size:18}),e.jsxs("span",{className:"font-body text-base",children:[u.length," kids"]})]})]}),S&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/40 text-crimson text-base",children:[e.jsx(ne,{size:18}),e.jsx("span",{children:S})]}),u.length===0?e.jsx("div",{className:"game-panel p-8 text-center",children:e.jsx("p",{className:"font-heading text-cream/50 text-[11px] leading-relaxed",children:"No kids in your family yet."})}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:u.map((s,t)=>e.jsxs(v.div,{className:"game-panel p-4",variants:de,initial:"hidden",animate:"visible",custom:t,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(se,{config:s.avatar_config,size:"md",name:s.display_name}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-heading text-cream text-[11px] leading-relaxed truncate",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gold font-body text-base",children:[e.jsx(ie,{size:14,fill:"currentColor"}),s.points_balance.toLocaleString()," XP"]}),s.current_streak>0&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-400 font-body text-base",children:[e.jsx(re,{size:14,fill:"currentColor"}),s.current_streak]})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-cream/60 font-body text-base",children:"Today"}),e.jsxs("span",{className:"text-cream font-body text-base",children:[s.today_completed,"/",s.today_total," quests"]})]}),e.jsx(W,{completed:s.today_completed,total:s.today_total})]})]},s.id))}),Y&&e.jsxs(v.section,{variants:me,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"font-heading text-gold text-xs mb-3",children:"Pending Approvals"}),e.jsxs("div",{className:"space-y-3",children:[C.map(s=>{var m,B,E,O;const t=`verify-${s.chore_id}`,a=`reject-${s.chore_id}`,l=f[t],c=f[a],d=l||c;return e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream font-body text-lg truncate",children:((m=s.chore)==null?void 0:m.title)||"Chore"}),e.jsxs("p",{className:"text-cream/50 font-body text-base",children:["by ",((B=s.user)==null?void 0:B.display_name)||"Kid",((E=s.chore)==null?void 0:E.requires_photo)&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 text-sky",children:[e.jsx(le,{size:12})," Photo attached"]}),e.jsxs("span",{className:"ml-2 text-gold",children:["+",(O=s.chore)==null?void 0:O.points," XP"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-gold !px-3 !py-2",disabled:d,onClick:()=>G(s.chore_id),title:"Approve",children:l?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(F,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:d,onClick:()=>I(s.chore_id),title:"Reject",children:c?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(X,{size:16})})]})]}),s.photo_proof_path&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:`/api/uploads/${s.photo_proof_path}`,alt:"Photo proof",className:"rounded-lg max-h-48 object-cover border border-[#2a2a4a]"})})]},`chore-${s.id}`)}),w.map(s=>{var d,m;const t=`approve-${s.id}`,a=`deny-${s.id}`,l=f[t],c=f[a];return e.jsxs("div",{className:"game-panel p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream font-body text-lg truncate",children:((d=s.reward)==null?void 0:d.title)||"Reward"}),e.jsxs("p",{className:"text-cream/50 font-body text-base",children:["by ",((m=s.user)==null?void 0:m.display_name)||"Kid"," Â·"," ",s.points_spent," XP"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-gold !px-3 !py-2",disabled:l||c,onClick:()=>Q(s.id),title:"Approve",children:l?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(F,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:l||c,onClick:()=>H(s.id),title:"Deny",children:c?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(X,{size:16})})]})]},`redemption-${s.id}`)})]})]}),e.jsxs("section",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{className:"game-btn game-btn-blue flex items-center gap-2 justify-center flex-1",onClick:()=>D("/chores"),children:[e.jsx(oe,{size:16}),"Create Quest"]}),e.jsxs("button",{className:"game-btn game-btn-purple flex items-center gap-2 justify-center flex-1",onClick:()=>{x(""),g(!0)},children:[e.jsx(ce,{size:16}),"Award Bonus XP"]})]}),e.jsx(te,{isOpen:U,onClose:()=>g(!1),title:"Award Bonus XP",actions:[{label:"Cancel",onClick:()=>g(!1),className:"game-btn game-btn-red"},{label:z?"Awarding...":"Award XP",onClick:J,disabled:z,className:"game-btn game-btn-gold"}],children:e.jsxs("div",{className:"space-y-4",children:[R&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-base text-center",children:R}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Select Kid"}),e.jsxs("select",{value:y,onChange:s=>P(s.target.value),className:j,children:[e.jsx("option",{value:"",children:"-- Choose --"}),u.map(s=>e.jsx("option",{value:s.id,children:s.display_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"XP Amount"}),e.jsx("input",{type:"number",min:"1",value:_,onChange:s=>A(s.target.value),placeholder:"50",className:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold/80 text-sm font-heading mb-2 tracking-wide",children:"Reason"}),e.jsx("input",{type:"text",value:b,onChange:s=>k(s.target.value),placeholder:"Great job helping out!",className:j})]})]})})]})}export{Pe as default};
