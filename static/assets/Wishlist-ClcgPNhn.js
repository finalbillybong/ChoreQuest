import{u as G,r as t,c as p,j as e,b as o,G as K}from"./index-CozlsxUV.js";import{M as Y}from"./Modal-5eArh6zT.js";import{P as B}from"./plus-DCQcrPYn.js";import{L as H}from"./loader-circle-iSei1Z8b.js";import{C as X}from"./check-C-PTF6_n.js";import{E as q}from"./external-link-C3sBO19O.js";import{T as J}from"./trash-2-WzPehisX.js";import"./index-qJO88N8d.js";import"./proxy-ifYGSNcC.js";function ie(){const{user:f}=G(),n=(f==null?void 0:f.role)==="kid",[g,y]=t.useState([]),[b,w]=t.useState(!0),[C,c]=t.useState(""),[k,j]=t.useState(!1),[d,S]=t.useState(""),[N,E]=t.useState(""),[v,z]=t.useState(""),[L,A]=t.useState(!1),[O,m]=t.useState(!1),[x,M]=t.useState(null),[W,_]=t.useState(""),[P,T]=t.useState(!1),[F,h]=t.useState(""),r=t.useCallback(async()=>{w(!0),c("");try{const s=await p("/api/wishlist");y(s.items||s||[])}catch(s){c(s.message||"Failed to load wishlist")}finally{w(!1)}},[]);t.useEffect(()=>{r()},[r]),t.useEffect(()=>{const s=()=>{r()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[r]);const R=async()=>{if(d.trim()){A(!0);try{const s={title:d.trim()};N.trim()&&(s.url=N.trim()),v.trim()&&(s.notes=v.trim()),await p("/api/wishlist",{method:"POST",body:s}),S(""),E(""),z(""),j(!1),r()}catch(s){c(s.message||"Failed to add item")}finally{A(!1)}}},U=async s=>{try{await p(`/api/wishlist/${s}`,{method:"DELETE"}),y(a=>a.filter(l=>l.id!==s))}catch(a){c(a.message||"Failed to delete item")}},$=s=>{M(s),_(""),h(""),m(!0)},D=async()=>{const s=parseInt(W,10);if(!s||s<=0){h("Enter a valid point cost");return}T(!0),h("");try{await p(`/api/wishlist/${x.id}/convert`,{method:"POST",body:{point_cost:s}}),m(!1),r()}catch(a){h(a.message||"Conversion failed")}finally{T(!1)}},i={};n||g.forEach(s=>{const a=s.user_display_name||s.username||s.user_id||"Unknown Hero";i[a]||(i[a]=[]),i[a].push(s)});const I=(s,a=!1,l=!1)=>{const u=!!s.converted_to_reward_id;return e.jsxs("div",{className:`game-panel p-4 flex items-start gap-3 ${u?"!border-emerald/40":""}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:u?e.jsx(X,{size:18,className:"text-emerald"}):e.jsx(o,{size:18,className:"text-sky"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-cream text-sm leading-tight",children:s.title}),s.url&&e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-sky text-xs flex items-center gap-1 mt-1 hover:text-sky/80 transition-colors",children:[e.jsx(q,{size:12}),e.jsx("span",{className:"truncate",children:s.url})]}),s.notes&&e.jsx("p",{className:"text-muted text-xs mt-1",children:s.notes}),u&&e.jsx("span",{className:"inline-block mt-1 text-emerald text-xs font-medium",children:"Converted to Reward"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[l&&!u&&e.jsx("button",{onClick:()=>$(s),className:"game-btn game-btn-purple !py-2 !px-3 !text-[8px]",title:"Convert to Reward",children:e.jsx(K,{size:14})}),a&&e.jsx("button",{onClick:()=>U(s.id),className:"p-2 rounded hover:bg-crimson/10 text-crimson/60 hover:text-crimson transition-colors",title:"Delete",children:e.jsx(J,{size:16})})]})]},s.id)};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{size:28,className:"text-sky"}),e.jsx("h1",{className:"text-cream text-xl font-extrabold leading-relaxed",children:"Wish List"})]}),n&&e.jsxs("button",{onClick:()=>j(!k),className:"game-btn game-btn-blue flex items-center gap-2",children:[e.jsx(B,{size:14}),"Add Wish"]})]}),C&&e.jsx("div",{className:"mb-4 p-3 rounded border-2 border-crimson/40 bg-crimson/10 text-crimson text-sm text-center",children:C}),n&&k&&e.jsxs("div",{className:"game-panel p-5 mb-6 space-y-3",children:[e.jsx("h3",{className:"text-cream text-lg font-bold tracking-wide mb-3",children:"New Wish"}),e.jsx("input",{type:"text",value:d,onChange:s=>S(s.target.value),placeholder:"What do you wish for?",className:"field-input"}),e.jsx("input",{type:"url",value:N,onChange:s=>E(s.target.value),placeholder:"Link (optional)",className:"field-input"}),e.jsx("textarea",{value:v,onChange:s=>z(s.target.value),placeholder:"Notes (optional)",rows:2,className:"field-input resize-none"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>j(!1),className:"game-btn game-btn-red",children:"Cancel"}),e.jsx("button",{onClick:R,disabled:L||!d.trim(),className:"game-btn game-btn-blue",children:L?"Adding...":"Add Wish"})]})]}),b&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(H,{size:32,className:"text-sky animate-spin"})}),!b&&n&&e.jsx("div",{className:"space-y-3",children:g.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(o,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:"Your wish list is empty"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:"Every hero has dreams. Add your first wish!"})]}):g.map(s=>I(s,!0,!1))}),!b&&!n&&e.jsx("div",{className:"space-y-8",children:Object.keys(i).length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(o,{size:48,className:"text-muted mx-auto mb-4"}),e.jsx("p",{className:"text-cream text-lg font-bold",children:"No wishes yet"}),e.jsx("p",{className:"text-muted text-sm mt-2",children:"Your heroes haven't made any wishes yet. Encourage them to dream!"})]}):Object.entries(i).map(([s,a])=>e.jsxs("div",{children:[e.jsxs("h2",{className:"text-cream text-lg font-bold mb-3 tracking-wide flex items-center gap-2",children:[e.jsx(o,{size:14,className:"text-sky"}),s,"'s Wishes"]}),e.jsx("div",{className:"space-y-3",children:a.map(l=>I(l,!1,!0))})]},s))}),e.jsx(Y,{isOpen:O,onClose:()=>m(!1),title:"Convert to Reward",actions:[{label:"Cancel",onClick:()=>m(!1),className:"game-btn game-btn-red"},{label:P?"Converting...":"Convert",onClick:D,className:"game-btn game-btn-gold",disabled:P}],children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-muted text-sm",children:["Convert"," ",e.jsx("span",{className:"text-cream font-bold",children:x==null?void 0:x.title})," ","into a redeemable reward:"]}),F&&e.jsx("div",{className:"p-2 rounded border border-crimson/40 bg-crimson/10 text-crimson text-sm",children:F}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gold text-sm font-medium mb-2 tracking-wide",children:"Point Cost (XP)"}),e.jsx("input",{type:"number",min:"1",value:W,onChange:s=>_(s.target.value),placeholder:"e.g. 500",className:"field-input"})]})]})})]})}export{ie as default};
