import{u as se,a as te,d as ae,r as a,b as c,j as e,f as h,U as ie,A as ne,k as re}from"./index-B01JWxCD.js";import{t as le}from"./questThemeText-BYk3jV6w.js";import{M as ce}from"./Modal-DMzy7hBo.js";import{T as oe}from"./triangle-alert-DjJ7k42k.js";import{m as g}from"./proxy-DQKAKBTU.js";import{S as de}from"./star-BOQ5w-1G.js";import{F as me}from"./flame-CEYDTFkO.js";import{C as xe}from"./camera-PxQmc37G.js";import{C as pe}from"./circle-check-DHJckvBy.js";import{C as ue}from"./circle-x-CW-PxjbT.js";import{M as he}from"./message-square-DIXTcNC0.js";import{S as fe}from"./send-BB61fbBn.js";import{P as be}from"./plus-N0M8l58P.js";import"./index-DWgGZRua.js";const je={hidden:{opacity:0,y:12},visible:v=>({opacity:1,y:0,transition:{delay:v*.06,type:"spring",stiffness:300,damping:28}})},ye={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.25}}};function Te(){const{user:v}=se(),f=te(),{colorTheme:M}=ae(),[o,R]=a.useState([]),[N,D]=a.useState([]),[K,q]=a.useState(!0),[S,d]=a.useState(null),[C,Q]=a.useState({}),[U,m]=a.useState(!1),[b,k]=a.useState({}),[w,P]=a.useState({}),[j,_]=a.useState(""),[z,A]=a.useState(""),[y,$]=a.useState(""),[B,F]=a.useState(!1),[T,l]=a.useState(""),r=a.useCallback(async()=>{try{d(null);const[s,t]=await Promise.all([c("/api/stats/family"),c("/api/calendar")]);R(s);const i=new Date().toISOString().slice(0,10),p=(t.days&&t.days[i]||[]).filter(u=>u.status==="completed");D(p)}catch(s){d(s.message||"Failed to load family data")}finally{q(!1)}},[]);a.useEffect(()=>{r()},[r]),a.useEffect(()=>{const s=()=>{r()};return window.addEventListener("ws:message",s),()=>window.removeEventListener("ws:message",s)},[r]);const x=(s,t)=>{Q(i=>({...i,[s]:t}))},G=async s=>{const t=`verify-${s}`;x(t,!0);try{await c(`/api/chores/${s}/verify`,{method:"POST"}),await r()}catch(i){d(i.message||"Failed to verify chore")}finally{x(t,!1)}},H=async s=>{const t=`reject-${s}`;x(t,!0);try{await c(`/api/chores/${s}/uncomplete`,{method:"POST"}),await r()}catch(i){d(i.message||"Failed to reject chore")}finally{x(t,!1)}},J=async()=>{if(l(""),!j){l("Select a kid");return}const s=parseInt(z,10);if(!s||s<=0){l("Enter a positive XP amount");return}if(!y.trim()){l("Enter a description");return}F(!0);try{await c(`/api/points/${j}/bonus`,{method:"POST",body:{amount:s,description:y.trim()}}),_(""),A(""),$(""),m(!1),await r()}catch(t){l(t.message||"Failed to award bonus XP")}finally{F(!1)}},W=async s=>{var i;const t=(i=b[s])==null?void 0:i.trim();if(t){P(n=>({...n,[s]:!0}));try{await c(`/api/chores/assignments/${s}/feedback`,{method:"POST",body:{feedback:t}}),k(n=>({...n,[s]:""}))}catch{}finally{P(n=>({...n,[s]:!1}))}}};function Y({completed:s,total:t}){const i=t>0?Math.round(s/t*100):0;return e.jsx("div",{className:"xp-bar",children:e.jsx(g.div,{className:"xp-bar-fill",initial:{width:0},animate:{width:`${i}%`},transition:{duration:.6,ease:[.22,1,.36,1]}})})}if(K)return e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(h,{className:"animate-spin text-sky",size:28})});const Z=N.length>0;return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"font-heading text-cream text-xl font-extrabold",children:"Family Overview"}),e.jsxs("div",{className:"flex items-center gap-1.5 text-muted text-sm",children:[e.jsx(ie,{size:16}),e.jsxs("span",{children:[o.length," members"]})]})]}),S&&e.jsxs("div",{className:"game-panel p-3 flex items-center gap-2 border-crimson/30 text-crimson text-sm",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:S})]}),o.length===0?e.jsx("div",{className:"game-panel p-10 text-center",children:e.jsx("p",{className:"text-muted text-sm",children:"No kids in your family yet."})}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:o.map((s,t)=>e.jsxs(g.div,{className:"game-panel p-4 cursor-pointer hover:border-sky/40 transition-colors",variants:je,initial:"hidden",animate:"visible",custom:t,onClick:()=>f(`/kids/${s.id}`),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ne,{config:s.avatar_config,size:"md",name:s.display_name,animate:!0}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-cream text-sm font-semibold truncate",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-gold text-xs font-semibold",children:[e.jsx(de,{size:12,fill:"currentColor"}),s.points_balance.toLocaleString()," XP"]}),s.current_streak>0&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-orange-400 text-xs font-semibold",children:[e.jsx(me,{size:12,fill:"currentColor"}),s.current_streak]})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted",children:"Today"}),e.jsxs("span",{className:"text-cream font-medium",children:[s.today_completed,"/",s.today_total," quests"]})]}),e.jsx(Y,{completed:s.today_completed,total:s.today_total})]})]},s.id))}),Z&&e.jsxs(g.section,{variants:ye,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"text-cream text-base font-bold mb-3",children:"Pending Quest Verifications"}),e.jsx("div",{className:"space-y-3",children:N.map(s=>{var E,L,O,X,V;const t=`verify-${s.chore_id}`,i=`reject-${s.chore_id}`,n=C[t],p=C[i],u=n||p;return e.jsxs("div",{className:"game-panel p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-cream text-sm font-medium truncate cursor-pointer hover:text-sky transition-colors",onClick:()=>f(`/chores/${s.chore_id}`),children:le(((E=s.chore)==null?void 0:E.title)||"Chore",M)}),e.jsxs("p",{className:"text-muted text-xs mt-0.5",children:["by ",((L=s.user)==null?void 0:L.display_name)||"Kid",((O=s.chore)==null?void 0:O.requires_photo)&&e.jsxs("span",{className:"inline-flex items-center gap-1 ml-2 text-sky",children:[e.jsx(xe,{size:10})," Photo"]}),e.jsxs("span",{className:"ml-2 text-gold font-medium",children:["+",(X=s.chore)==null?void 0:X.points," XP"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"game-btn game-btn-blue !px-3 !py-2",disabled:u,onClick:()=>G(s.chore_id),title:"Approve",children:n?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(pe,{size:16})}),e.jsx("button",{className:"game-btn game-btn-red !px-3 !py-2",disabled:u,onClick:()=>H(s.chore_id),title:"Reject",children:p?e.jsx(h,{size:14,className:"animate-spin"}):e.jsx(ue,{size:16})})]})]}),s.photo_proof_path&&e.jsx("div",{className:"mt-3",children:e.jsx("img",{src:`/api/uploads/${s.photo_proof_path}`,alt:"Photo proof",className:"rounded-lg max-h-48 object-cover border border-border"})}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(he,{size:14,className:"text-muted flex-shrink-0"}),e.jsx("input",{type:"text",value:b[s.id]||"",onChange:I=>k(ee=>({...ee,[s.id]:I.target.value})),placeholder:"Leave feedback for this quest...",maxLength:500,className:"field-input !py-1.5 !text-xs flex-1"}),e.jsx("button",{onClick:()=>W(s.id),disabled:w[s.id]||!((V=b[s.id])!=null&&V.trim()),className:"game-btn game-btn-blue !py-1.5 !px-2 flex-shrink-0",title:"Send feedback",children:w[s.id]?e.jsx(h,{size:12,className:"animate-spin"}):e.jsx(fe,{size:12})})]}),s.feedback&&e.jsxs("p",{className:"mt-1.5 ml-6 text-muted text-xs italic",children:["Feedback: ",s.feedback]})]},`chore-${s.id}`)})})]}),e.jsxs("section",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{className:"game-btn game-btn-blue flex items-center gap-2 justify-center flex-1",onClick:()=>f("/chores"),children:[e.jsx(be,{size:16}),"Create Quest"]}),e.jsxs("button",{className:"game-btn game-btn-purple flex items-center gap-2 justify-center flex-1",onClick:()=>{l(""),m(!0)},children:[e.jsx(re,{size:16}),"Award Bonus XP"]})]}),e.jsx(ce,{isOpen:U,onClose:()=>m(!1),title:"Award Bonus XP",actions:[{label:"Cancel",onClick:()=>m(!1),className:"game-btn game-btn-red"},{label:B?"Awarding...":"Award XP",onClick:J,disabled:B,className:"game-btn game-btn-gold"}],children:e.jsxs("div",{className:"space-y-4",children:[T&&e.jsx("div",{className:"p-2 rounded-lg border border-crimson/30 bg-crimson/10 text-crimson text-sm text-center",children:T}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"Select Kid"}),e.jsxs("select",{value:j,onChange:s=>_(s.target.value),className:"field-input",children:[e.jsx("option",{value:"",children:"-- Choose --"}),o.map(s=>e.jsx("option",{value:s.id,children:s.display_name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"XP Amount"}),e.jsx("input",{type:"number",min:"1",value:z,onChange:s=>A(s.target.value),placeholder:"50",className:"field-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-cream/80 text-sm font-medium mb-1.5",children:"Reason"}),e.jsx("input",{type:"text",value:y,onChange:s=>$(s.target.value),placeholder:"Great job helping out!",className:"field-input"})]})]})})]})}export{Te as default};
