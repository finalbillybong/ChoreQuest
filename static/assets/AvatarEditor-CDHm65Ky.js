import{u as W,a as D,r as u,b as B,j as e,l as P,f as $,A as I,e as Y,g as G,h as X}from"./index-B7y1uFwl.js";import{S as U}from"./save-Be_TDe2R.js";import{C as V}from"./crosshair-BkU86Aan.js";import{C as K}from"./chevron-left-CKcbOJDQ.js";import{C as q}from"./chevron-right-7thI_uZx.js";import{H as J}from"./heart-SuKfgBYT.js";import{L as M}from"./lock-DK1jATCX.js";const Q=[{id:"round",label:"Round"},{id:"oval",label:"Oval"},{id:"square",label:"Square"},{id:"diamond",label:"Diamond"},{id:"heart",label:"Heart"},{id:"long",label:"Long"},{id:"triangle",label:"Triangle"},{id:"pear",label:"Pear"},{id:"wide",label:"Wide"}],Z=[{id:"none",label:"None"},{id:"short",label:"Short"},{id:"long",label:"Long"},{id:"spiky",label:"Spiky"},{id:"curly",label:"Curly"},{id:"mohawk",label:"Mohawk"},{id:"buzz",label:"Buzz"},{id:"ponytail",label:"Ponytail"},{id:"bun",label:"Bun"},{id:"pigtails",label:"Pigtails"},{id:"afro",label:"Afro"},{id:"braids",label:"Braids"},{id:"wavy",label:"Wavy"},{id:"side_part",label:"Side Part"},{id:"fade",label:"Fade"},{id:"dreadlocks",label:"Dreads"},{id:"bob",label:"Bob"},{id:"shoulder",label:"Shoulder"},{id:"undercut",label:"Undercut"},{id:"twin_buns",label:"Twin Buns"}],ee=[{id:"normal",label:"Normal"},{id:"happy",label:"Happy"},{id:"wide",label:"Wide"},{id:"sleepy",label:"Sleepy"},{id:"wink",label:"Wink"},{id:"angry",label:"Angry"},{id:"dot",label:"Dot"},{id:"star",label:"Star"},{id:"glasses",label:"Glasses"},{id:"sunglasses",label:"Shades"},{id:"eye_patch",label:"Eye Patch"},{id:"crying",label:"Crying"},{id:"heart_eyes",label:"Hearts"},{id:"dizzy",label:"Dizzy"},{id:"closed",label:"Closed"}],te=[{id:"smile",label:"Smile"},{id:"grin",label:"Grin"},{id:"neutral",label:"Neutral"},{id:"open",label:"Open"},{id:"tongue",label:"Tongue"},{id:"frown",label:"Frown"},{id:"surprised",label:"Surprised"},{id:"smirk",label:"Smirk"},{id:"braces",label:"Braces"},{id:"vampire",label:"Vampire"},{id:"whistle",label:"Whistle"},{id:"mask",label:"Mask"},{id:"beard",label:"Beard"},{id:"moustache",label:"Moustache"}],se=[{id:"slim",label:"Slim"},{id:"regular",label:"Regular"},{id:"broad",label:"Broad"}],ae=[{id:"none",label:"None"},{id:"crown",label:"Crown"},{id:"wizard",label:"Wizard"},{id:"beanie",label:"Beanie"},{id:"cap",label:"Cap"},{id:"pirate",label:"Pirate"},{id:"headphones",label:"Headphones"},{id:"tiara",label:"Tiara"},{id:"horns",label:"Horns"},{id:"bunny_ears",label:"Bunny Ears"},{id:"cat_ears",label:"Cat Ears"},{id:"halo",label:"Halo"},{id:"viking",label:"Viking"}],le=[{id:"scarf",label:"Scarf"},{id:"necklace",label:"Necklace"},{id:"bow_tie",label:"Bow Tie"},{id:"cape",label:"Cape"},{id:"wings",label:"Wings"},{id:"shield",label:"Shield"},{id:"sword",label:"Sword"}],oe=[{id:"none",label:"None"},{id:"freckles",label:"Freckles"},{id:"blush",label:"Blush"},{id:"face_paint",label:"Face Paint"},{id:"scar",label:"Scar"},{id:"bandage",label:"Bandage"},{id:"stickers",label:"Stickers"}],re=[{id:"none",label:"None"},{id:"stripes",label:"Stripes"},{id:"stars",label:"Stars"},{id:"camo",label:"Camo"},{id:"tie_dye",label:"Tie Dye"},{id:"plaid",label:"Plaid"}],ce=[{id:"none",label:"None"},{id:"cat",label:"Cat"},{id:"dog",label:"Dog"},{id:"dragon",label:"Dragon"},{id:"owl",label:"Owl"},{id:"bunny",label:"Bunny"},{id:"phoenix",label:"Phoenix"}],ne=[{id:"right",label:"Right"},{id:"left",label:"Left"},{id:"head",label:"Head"},{id:"custom",label:"Custom"}],ie=[{id:"none",label:"None"},{id:"crown",label:"Crown"},{id:"party_hat",label:"Party Hat"},{id:"bow",label:"Bow"},{id:"bandana",label:"Bandana"},{id:"halo",label:"Halo"},{id:"flower",label:"Flower"}],de=["#ffe0bd","#ffcc99","#f5d6b8","#f8d9c0","#e8b88a","#d4a373","#c68642","#a67c52","#8d5524","#6b3a2a","#4a2912","#3b1f0e","#f0c4a8","#d4956a","#b07848","#8a6642"],xe=["#4a3728","#1a1a2e","#8b4513","#d4a017","#c0392b","#2e86c1","#7d3c98","#27ae60","#e74c3c","#f39c12","#ecf0f1","#ff6b9d"],me=["#333333","#1a5276","#27ae60","#8b4513","#7d3c98","#c0392b","#2e86c1","#e74c3c"],be=["#cc6666","#e74c3c","#d4a373","#c0392b","#ff6b9d","#a93226","#8b4513","#333333"],ue=["#3b82f6","#ef4444","#10b981","#f59e0b","#a855f7","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1","#1a1a2e","#ecf0f1"],he=["#1a1a2e","#0f0e17","#16213e","#1b4332","#4a1942","#2d1b69","#1a3a3a","#3d0c02","#2e86c1","#27ae60","#f39c12","#8e44ad"],pe=["#f39c12","#e74c3c","#3b82f6","#10b981","#a855f7","#ec4899","#f59e0b","#1a1a2e","#c0c0c0","#f9d71c","#8b4513","#ecf0f1"],fe=["#3b82f6","#ef4444","#10b981","#f39c12","#a855f7","#ec4899","#c0c0c0","#f9d71c","#8b4513","#1a1a2e","#ecf0f1","#06b6d4"],C=["#8b4513","#4a3728","#f39c12","#ef4444","#10b981","#a855f7","#ecf0f1","#1a1a2e","#c0c0c0","#ff6b9d","#06b6d4","#f59e0b"],ye=2,E={_v:ye,head:"round",hair:"short",eyes:"normal",mouth:"smile",body:"regular",head_color:"#ffcc99",hair_color:"#4a3728",eye_color:"#333333",mouth_color:"#cc6666",body_color:"#3b82f6",bg_color:"#1a1a2e",hat:"none",hat_color:"#f39c12",accessory:"none",accessories:[],accessory_color:"#3b82f6",face_extra:"none",outfit_pattern:"none",pet:"none",pet_color:"#8b4513",pet_color_body:"",pet_color_ears:"",pet_color_tail:"",pet_color_accent:"",pet_position:"right",pet_x:26,pet_y:20,pet_accessory:"none"},_e=[{id:"head",label:"Head"},{id:"skin",label:"Skin"},{id:"hair",label:"Hair"},{id:"eyes",label:"Eyes"},{id:"mouth",label:"Mouth"},{id:"body",label:"Body"},{id:"outfit",label:"Outfit"},{id:"pattern",label:"Pattern"},{id:"background",label:"BG"},{id:"hat",label:"Hat"},{id:"face",label:"Face"},{id:"accessory",label:"Gear"},{id:"pet",label:"Pet"}];function f({colors:a,selected:s,onSelect:l}){return e.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.map(i=>e.jsx("button",{onClick:()=>l(i),className:`w-7 h-7 rounded-full border-2 transition-all ${s===i?"border-sky scale-110":"border-transparent hover:border-border-light"}`,style:{backgroundColor:i},"aria-label":i},i))})}function _({options:a,selected:s,onSelect:l,lockedItems:i,configKey:d,onPreview:n,onPreviewEnd:r}){return e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(o=>{const t=i&&i.has(o.id);return e.jsxs("button",{onClick:()=>!t&&l(o.id),onMouseEnter:()=>t&&d&&(n==null?void 0:n(d,o.id)),onMouseLeave:()=>t&&(r==null?void 0:r()),onTouchStart:()=>t&&d&&(n==null?void 0:n(d,o.id)),onTouchEnd:()=>t&&(r==null?void 0:r()),onTouchCancel:()=>t&&(r==null?void 0:r()),className:`px-3 py-1.5 rounded-lg border text-xs font-medium transition-all flex items-center gap-1 select-none ${t?"border-amber-500/30 text-muted/60 bg-amber-500/5":s===o.id?"border-sky bg-sky/10 text-sky":"border-border text-muted hover:border-border-light hover:text-cream"}`,style:t?{WebkitTouchCallout:"none",touchAction:"manipulation"}:void 0,children:[t&&e.jsx(M,{size:10,className:"text-amber-500/60"}),o.label]},o.id)})})}function je({options:a,selected:s,onToggle:l,lockedItems:i,configKey:d,onPreview:n,onPreviewEnd:r}){const o=new Set(s||[]);return e.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(t=>{const c=i&&i.has(t.id),h=o.has(t.id);return e.jsxs("button",{onClick:()=>!c&&l(t.id),onMouseEnter:()=>c&&d&&(n==null?void 0:n(d,t.id)),onMouseLeave:()=>c&&(r==null?void 0:r()),onTouchStart:()=>c&&d&&(n==null?void 0:n(d,t.id)),onTouchEnd:()=>c&&(r==null?void 0:r()),onTouchCancel:()=>c&&(r==null?void 0:r()),className:`px-3 py-1.5 rounded-lg border text-xs font-medium transition-all flex items-center gap-1 select-none ${c?"border-amber-500/30 text-muted/60 bg-amber-500/5":h?"border-sky bg-sky/10 text-sky":"border-border text-muted hover:border-border-light hover:text-cream"}`,style:c?{WebkitTouchCallout:"none",touchAction:"manipulation"}:void 0,children:[c&&e.jsx(M,{size:10,className:"text-amber-500/60"}),t.label]},t.id)})})}const k=[0,50,150,350,700,1200,2e3,3500],T=["","Hatchling","Youngling","Companion","Loyal","Brave","Mighty","Majestic","Legendary"],v=["","#94a3b8","#10b981","#3b82f6","#a855f7","#f59e0b","#f97316","#ef4444","#d946ef"];function ge(a){let s=1;for(let n=0;n<k.length;n++)a>=k[n]&&(s=n+1);const l=k[s-1]||0,i=k[s]||null,d=i?(a-l)/(i-l):1;return{level:s,name:T[s],nextName:T[s+1]||null,xp:a,threshold:l,nextThreshold:i,progress:d}}function Se({petType:a,colors:s,level:l=1}){if(!a||a==="none")return null;const i=1+(l-1)*.04,d=["dragon","phoenix"].includes(a),n=d?25:26,r=d?19:20,o=l>=7?"#f59e0b":l>=5?"#a855f7":l>=2?"#3b82f6":null;return e.jsx("svg",{width:48,height:48,viewBox:"0 0 12 12",className:"rounded-lg",style:{background:"#111827"},children:e.jsxs("g",{transform:`translate(6,6) scale(${i*1.3}) translate(${-n},${-r})`,children:[o&&e.jsx("circle",{cx:n,cy:r,r:4,fill:o,opacity:l>=5?.25:.18}),G(a,s,"right",{}),X(a,l,s,"right")]})})}function Ne({config:a,onPlace:s}){const l=u.useRef(null),i=r=>{const o=l.current;if(!o)return;const t=o.getBoundingClientRect(),c=Math.round((r.clientX-t.left)/t.width*32),h=Math.round((r.clientY-t.top)/t.height*32);s(Math.max(4,Math.min(28,c)),Math.max(4,Math.min(28,h)))},d=a.pet_x??26,n=a.pet_y??20;return e.jsxs("div",{className:"relative cursor-crosshair",onClick:i,children:[e.jsx("div",{className:"avatar-idle rounded-2xl",children:e.jsx(I,{config:a,size:"xl"})}),e.jsxs("svg",{ref:l,className:"absolute inset-0 w-full h-full rounded-2xl",viewBox:"0 0 32 32",style:{pointerEvents:"all"},onClick:r=>{r.stopPropagation();const t=r.currentTarget.getBoundingClientRect(),c=Math.round((r.clientX-t.left)/t.width*32),h=Math.round((r.clientY-t.top)/t.height*32);s(Math.max(4,Math.min(28,c)),Math.max(4,Math.min(28,h)))},children:[e.jsx("circle",{cx:d,cy:n,r:"1.5",fill:"none",stroke:"#3b82f6",strokeWidth:"0.4",className:"pet-place-indicator"}),e.jsx("line",{x1:d-2,y1:n,x2:d+2,y2:n,stroke:"#3b82f6",strokeWidth:"0.3",opacity:"0.6"}),e.jsx("line",{x1:d,y1:n-2,x2:d,y2:n+2,stroke:"#3b82f6",strokeWidth:"0.3",opacity:"0.6"})]}),e.jsxs("p",{className:"text-center text-sky text-[10px] font-medium mt-1.5 flex items-center justify-center gap-1",children:[e.jsx(V,{size:10})," Tap to place your pet"]})]})}function Ce(a,s){if(!s||s==="none")return 0;const l=a.pet_xp_map||{};return s in l?l[s]:a.pet_xp||0}function ke({config:a,set:s,locked:l,previewProps:i,petStats:d}){const n=a.pet&&a.pet!=="none",r=Ce(a,a.pet),o=ge(r),t=Y(a),c=a.pet_color||"#8b4513",h=(x,y)=>{s(x,y===c?"":y)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-2",children:"Companion"}),e.jsx(_,{options:ce,selected:a.pet,onSelect:x=>s("pet",x),lockedItems:l,configKey:"pet",...i})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-surface-raised/50 rounded-xl p-3 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{size:14,className:"fill-current",style:{color:v[o.level]}}),e.jsxs("span",{className:"text-cream text-xs font-bold",style:{color:v[o.level]},children:["Lv",o.level," ",o.name]})]}),e.jsx("span",{className:"text-muted text-[10px] font-medium",children:o.nextThreshold?`${r} / ${o.nextThreshold} XP`:`${r} XP — MAX`})]}),o.nextThreshold&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"h-2 bg-navy rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${Math.round(o.progress*100)}%`,backgroundColor:v[o.level]}})}),e.jsxs("p",{className:"text-muted text-[10px] mt-1",children:[o.nextThreshold-r," XP to Level ",o.level+1," (",o.nextName,")"]})]}),e.jsx("div",{className:"overflow-x-auto -mx-1 px-1 mt-2",children:e.jsx("div",{className:"flex gap-2",style:{minWidth:"max-content"},children:T.slice(1).map((x,y)=>{const p=y+1,S=p===o.level,g=p<o.level,N=p>o.level;return e.jsxs("div",{className:`text-center flex-shrink-0 rounded-lg p-1 ${S?"bg-sky/10 ring-1 ring-sky/40":""}`,style:{opacity:N?.35:g?.55:1},children:[e.jsxs("p",{className:"text-[9px] font-medium mb-0.5",style:{color:v[p]},children:[S?"▸ ":"","Lv",p]}),e.jsx(Se,{petType:a.pet,colors:t,level:p}),e.jsx("p",{className:"text-muted text-[8px] mt-0.5",children:x})]},p)})})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-2",children:"Position"}),e.jsx(_,{options:ne,selected:a.pet_position||"right",onSelect:x=>s("pet_position",x)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Body Colour"}),e.jsx("button",{onClick:()=>{s("pet_color_body",""),s("pet_color_ears",""),s("pet_color_tail",""),s("pet_color_accent","")},className:"text-[10px] text-sky hover:text-sky/80 transition-colors",children:"Reset all to match"})]}),e.jsx(f,{colors:C,selected:a.pet_color,onSelect:x=>s("pet_color",x)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-2",children:"Ears"}),e.jsx(f,{colors:C,selected:a.pet_color_ears||a.pet_color||"#8b4513",onSelect:x=>h("pet_color_ears",x)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-2",children:"Tail"}),e.jsx(f,{colors:C,selected:a.pet_color_tail||a.pet_color||"#8b4513",onSelect:x=>h("pet_color_tail",x)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-2",children:"Accent"}),e.jsx(f,{colors:C,selected:a.pet_color_accent||a.pet_color||"#8b4513",onSelect:x=>h("pet_color_accent",x)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-xs font-medium mb-2",children:"Pet Accessory"}),e.jsx(_,{options:ie,selected:a.pet_accessory||"none",onSelect:x=>s("pet_accessory",x)})]})]})]})}function ve({category:a,config:s,set:l,lockedByCategory:i,onPreview:d,onPreviewEnd:n}){const r=i[a]||new Set,o={onPreview:d,onPreviewEnd:n};switch(a){case"head":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Shape"}),e.jsx(_,{options:Q,selected:s.head,onSelect:t=>l("head",t),lockedItems:r,configKey:"head",...o})]});case"skin":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Colour"}),e.jsx(f,{colors:de,selected:s.head_color,onSelect:t=>l("head_color",t)})]});case"hair":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Style"}),e.jsx(_,{options:Z,selected:s.hair,onSelect:t=>l("hair",t),lockedItems:r,configKey:"hair",...o}),e.jsx("p",{className:"text-muted text-xs font-medium",children:"Colour"}),e.jsx(f,{colors:xe,selected:s.hair_color,onSelect:t=>l("hair_color",t)})]});case"eyes":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Style"}),e.jsx(_,{options:ee,selected:s.eyes,onSelect:t=>l("eyes",t),lockedItems:r,configKey:"eyes",...o}),e.jsx("p",{className:"text-muted text-xs font-medium",children:"Colour"}),e.jsx(f,{colors:me,selected:s.eye_color,onSelect:t=>l("eye_color",t)})]});case"mouth":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Style"}),e.jsx(_,{options:te,selected:s.mouth,onSelect:t=>l("mouth",t),lockedItems:r,configKey:"mouth",...o}),e.jsx("p",{className:"text-muted text-xs font-medium",children:"Colour"}),e.jsx(f,{colors:be,selected:s.mouth_color,onSelect:t=>l("mouth_color",t)})]});case"body":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Shape"}),e.jsx(_,{options:se,selected:s.body,onSelect:t=>l("body",t)})]});case"outfit":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Colour"}),e.jsx(f,{colors:ue,selected:s.body_color,onSelect:t=>l("body_color",t)})]});case"pattern":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Pattern"}),e.jsx(_,{options:re,selected:s.outfit_pattern,onSelect:t=>l("outfit_pattern",t),lockedItems:r,configKey:"outfit_pattern",...o})]});case"background":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Colour"}),e.jsx(f,{colors:he,selected:s.bg_color,onSelect:t=>l("bg_color",t)})]});case"hat":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Style"}),e.jsx(_,{options:ae,selected:s.hat,onSelect:t=>l("hat",t),lockedItems:r,configKey:"hat",...o}),e.jsx("p",{className:"text-muted text-xs font-medium",children:"Colour"}),e.jsx(f,{colors:pe,selected:s.hat_color,onSelect:t=>l("hat_color",t)})]});case"face":return e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-muted text-xs font-medium",children:"Extra"}),e.jsx(_,{options:oe,selected:s.face_extra,onSelect:t=>l("face_extra",t),lockedItems:r,configKey:"face_extra",...o})]});case"accessory":{const t=Array.isArray(s.accessories)&&s.accessories.length>0?s.accessories:s.accessory&&s.accessory!=="none"?[s.accessory]:[],c=x=>{const y=new Set(t);y.has(x)?y.delete(x):y.add(x);const p=[...y];l("accessories",p),l("accessory",p.length>0?p[0]:"none")},h=()=>{l("accessories",[]),l("accessory","none")};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-muted text-xs font-medium",children:["Gear ",e.jsx("span",{className:"text-muted/50",children:"(select multiple)"})]}),e.jsx(je,{options:le,selected:t,onToggle:c,lockedItems:r,configKey:"accessory",...o}),t.length>0&&e.jsx("button",{onClick:h,className:"text-[10px] text-crimson hover:text-crimson/80 transition-colors",children:"Clear all gear"}),e.jsx("p",{className:"text-muted text-xs font-medium",children:"Colour"}),e.jsx(f,{colors:fe,selected:s.accessory_color,onSelect:x=>l("accessory_color",x)})]})}case"pet":return e.jsx(ke,{config:s,set:l,locked:r,previewProps:o});default:return null}}const Oe={head:"head",hair:"hair",eyes:"eyes",mouth:"mouth",hat:"hat",accessory:"accessory",face:"face_extra",pattern:"outfit_pattern",pet:"pet"};function Te({openCategory:a,onSelect:s}){const l=u.useRef(null),[i,d]=u.useState(!1),[n,r]=u.useState(!1),o=u.useCallback(()=>{const c=l.current;c&&(d(c.scrollLeft>4),r(c.scrollLeft<c.scrollWidth-c.clientWidth-4))},[]);u.useEffect(()=>{const c=l.current;if(c)return o(),c.addEventListener("scroll",o,{passive:!0}),window.addEventListener("resize",o),()=>{c.removeEventListener("scroll",o),window.removeEventListener("resize",o)}},[o]);const t=c=>{const h=l.current;h&&h.scrollBy({left:c*120,behavior:"smooth"})};return e.jsxs("div",{className:"flex-shrink-0 border-b border-border bg-surface px-1 py-2 relative",children:[i&&e.jsx("button",{onClick:()=>t(-1),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 w-7 h-7 flex items-center justify-center rounded-full bg-surface/90 border border-border text-muted hover:text-cream shadow-sm","aria-label":"Scroll left",children:e.jsx(K,{size:14})}),e.jsx("div",{ref:l,className:"flex gap-2 overflow-x-auto pb-0.5 px-2 scrollbar-hide",children:_e.map(c=>e.jsx("button",{onClick:()=>s(c.id),className:`flex-shrink-0 px-3 py-1.5 rounded-lg border text-xs font-medium transition-all ${a===c.id?"border-sky bg-sky/15 text-sky":"border-border text-muted hover:border-border-light hover:text-cream"}`,children:c.label},c.id))}),n&&e.jsx("button",{onClick:()=>t(1),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 w-7 h-7 flex items-center justify-center rounded-full bg-surface/90 border border-border text-muted hover:text-cream shadow-sm","aria-label":"Scroll right",children:e.jsx(q,{size:14})})]})}function we(){const{user:a,updateUser:s}=W(),l=D(),[i,d]=u.useState(()=>({...E,...(a==null?void 0:a.avatar_config)||{}})),[n,r]=u.useState(!1),[o,t]=u.useState(""),[c,h]=u.useState("head"),[x,y]=u.useState({}),[p,S]=u.useState(null),g=u.useCallback(()=>l(-1),[l]),N=u.useCallback(async()=>{try{const b=await B("/api/avatar/items");if(!Array.isArray(b))return;const m={};for(const j of b)!j.unlocked&&!j.is_default&&(m[j.category]||(m[j.category]=new Set),m[j.category].add(j.item_id));y(m)}catch{}},[]);u.useEffect(()=>{N()},[N]),u.useEffect(()=>{a!=null&&a.avatar_config&&d(b=>{const m={...E,...a.avatar_config||{}};return JSON.stringify(b)===JSON.stringify(m)?b:m})},[a==null?void 0:a.avatar_config]),u.useEffect(()=>{const b=m=>{m.key==="Escape"&&g()};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[g]);const L=p?{...i,[p.key]:p.value}:i,A={};for(const[b,m]of Object.entries(Oe))x[m]&&(A[b]=x[m]);const w=(b,m)=>{d(j=>{const O={...j,[b]:m};if(b==="pet"){const R=O.pet_xp_map||{};O.pet_xp=m&&m!=="none"&&m in R?R[m]:0}return O}),t("")},z=u.useCallback((b,m)=>S({key:b,value:m}),[]),H=u.useCallback(()=>S(null),[]),F=async()=>{r(!0),t("");try{const b=await B("/api/avatar",{method:"PUT",body:{config:i}});s({avatar_config:b.avatar_config||i}),t("Saved!"),setTimeout(()=>g(),600)}catch(b){t(b.message||"Failed to save")}finally{r(!1),setTimeout(()=>t(""),3e3)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-surface",children:[e.jsxs("div",{className:"flex-shrink-0 border-b border-border bg-surface-raised/50 px-4 pt-3 pb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g,className:"p-1.5 rounded-lg hover:bg-surface-raised transition-colors text-muted hover:text-cream","aria-label":"Back",children:e.jsx(P,{size:18})}),e.jsx("h2",{className:"font-heading text-cream text-lg font-bold",children:"Customise Avatar"})]}),e.jsxs("button",{onClick:F,disabled:n,className:"game-btn game-btn-blue flex items-center gap-1.5 !py-1.5 !px-4 !text-xs",children:[n?e.jsx($,{size:14,className:"animate-spin"}):e.jsx(U,{size:14}),n?"Saving...":o||"Save"]})]}),e.jsx("div",{className:"flex justify-center",children:c==="pet"&&i.pet_position==="custom"&&i.pet&&i.pet!=="none"?e.jsx(Ne,{config:L,onPlace:(b,m)=>{d(j=>({...j,pet_x:b,pet_y:m})),t("")}}):e.jsx("div",{className:`avatar-idle rounded-2xl transition-shadow duration-300 ${p?"shadow-[0_0_16px_rgba(245,158,11,0.45)]":""}`,children:e.jsx(I,{config:L,size:"xl"})})})]}),e.jsx(Te,{openCategory:c,onSelect:h}),e.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain p-4",children:c&&e.jsx(ve,{category:c,config:i,set:w,lockedByCategory:A,onPreview:z,onPreviewEnd:H})})]})}export{we as default};
